"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[3469],{28453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var o=t(96540);const c={},i=o.createContext(c);function r(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),o.createElement(i.Provider,{value:n},e.children)}},28490(e,n,t){t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"AccountTokenization/OwnAppTokens/TokenizeCustomerAccount","title":"Own App Tokens","description":"Tokenize your customer\'s account","source":"@site/docs/AccountTokenization/OwnAppTokens/TokenizeCustomerAccount.md","sourceDirName":"AccountTokenization/OwnAppTokens","slug":"/AccountTokenization/OwnAppTokens/TokenizeCustomerAccount","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/TokenizeCustomerAccount","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Account Tokenization","permalink":"/github.io/docs/tags/account-tokenization"},{"inline":true,"label":"Own App Tokens","permalink":"/github.io/docs/tags/own-app-tokens"},{"inline":true,"label":"NFC","permalink":"/github.io/docs/tags/nfc"},{"inline":true,"label":"Tap and Pay","permalink":"/github.io/docs/tags/tap-and-pay"}],"version":"current","frontMatter":{"title":"Own App Tokens","tags":["Account Tokenization","Own App Tokens","NFC","Tap and Pay"]},"sidebar":"someSidebar","previous":{"title":"Create a secure device wallet","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/CreateSecureDeviceWallet"},"next":{"title":"Tokenize an existing card","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/TokenizeExistingCard"}}');var c=t(74848),i=t(28453);const r={title:"Own App Tokens",tags:["Account Tokenization","Own App Tokens","NFC","Tap and Pay"]},a="Own App Tokens",s={},d=[{value:"Tokenize your customer&#39;s account",id:"tokenize-your-customers-account",level:2},{value:"Enroll the tokenized account into the secure device wallet",id:"enroll-the-tokenized-account-into-the-secure-device-wallet",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"own-app-tokens",children:"Own App Tokens"})}),"\n",(0,c.jsx)(n.h2,{id:"tokenize-your-customers-account",children:"Tokenize your customer's account"}),"\n",(0,c.jsx)(n.p,{children:"Once the device is ready with a secure device wallet provisioned, it\u2019s time to tokenize the customer\u2019s account into the secure device wallet."}),"\n",(0,c.jsx)(n.p,{children:"We tokenize a customer\u2019s account and bind it to a secure device wallet by initiating an API call to Open Fabric."}),"\n",(0,c.jsx)(n.admonition,{type:"info",children:(0,c.jsx)(n.p,{children:"For security reasons, it is essential to make the API call from the backend."})}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.a,{href:"/apis#tag/Provision-Account/operation/PbAProvision",children:"Provision account API"})," allows you to tokenize the customer's account. Please make sure you include the secure device wallet identifier as ",(0,c.jsx)(n.code,{children:"wallet_id"}),". The API will respond back to you with device opaque data (",(0,c.jsx)(n.code,{children:"sdk_tokenize_account_device_data"}),") which then needs to be handed back to the SDK for the next step."]}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"tenant_customer_ref"})," and ",(0,c.jsx)(n.code,{children:"tenant_account_ref"})," are required fields and need to be filled with a reference to your customer and their account."]}),"\n",(0,c.jsx)(n.admonition,{type:"tip",children:(0,c.jsxs)(n.p,{children:["Use the ",(0,c.jsx)(n.code,{children:"tenant_account_ref"})," if you want to distinguish different funding sources. But if customers do not have multiple accounts in your system, you may also choose to copy the value of ",(0,c.jsx)(n.code,{children:"tenant_customer_ref"})," in this field."]})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Sample request"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Headers:\r\n  Idempotency-Key: 40709949-0712-487c-a2fe-1dd2e64af506\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\r\n    "tenant_customer_ref": "of_customer_1",\r\n    "tenant_account_ref": "FR123456789054001111012345672509",\r\n    "wallet_id": "7867519840724679119",\r\n    "billing_currency": "SGD",\r\n    "billing_address": {\r\n        "address_line_1": "Singapore",\r\n        "post_code": "000001"\r\n    },\r\n    "device_name": "Test Device"\r\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Sample response"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\r\n    "tenant_account_ref": "FR123456789054001111012345672509",\r\n    "sdk_tokenize_account_device_data": "eyJ4NWMiOlsiTUlJQzNqQ0NBY2FnQXdJQkFnSUpBT1FDdnc2Tjh4WFRNQTBH...",\r\n    "customer_id": "fd2b8723-0a5a-4fd5-8efc-b82d0316c621",\r\n    "account_id": "58d74bf2-eb6c-4eeb-9561-f1d3007b5d46",\r\n    "device_id": "4eda3b53-1dd9-4c09-b892-362cc2dcbf52"\r\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"enroll-the-tokenized-account-into-the-secure-device-wallet",children:"Enroll the tokenized account into the secure device wallet"}),"\n",(0,c.jsxs)(n.p,{children:["Now that we have tokenized the customer\u2019s account and generated the device opaque data (",(0,c.jsx)(n.code,{children:"sdk_tokenize_account_device_data"}),"), it is time to enroll the tokenized account into the secure device wallet."]}),"\n",(0,c.jsxs)(n.p,{children:["To complete the setup, the device opaque data (",(0,c.jsx)(n.code,{children:"sdk_tokenize_account_device_data"}),") should be injected into the SDK. Use the ",(0,c.jsx)(n.code,{children:"enrollAccount()"})," method to inject ",(0,c.jsx)(n.code,{children:"sdk_tokenize_account_device_data"})," received in the previous step."]}),"\n",(0,c.jsxs)(n.p,{children:["If all goes well, the callback ",(0,c.jsx)(n.code,{children:"OpenfabricCallback#onSuccess()"})," is called. We will initiate the process of asynchronously pulling the payment cryptograms generated for the tokenized account. When this is complete, the app is notified with the callback ",(0,c.jsx)(n.code,{children:"CardEventListener#onCardsUpdated()"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["If an error occurs anytime during the above process, the callback ",(0,c.jsx)(n.code,{children:"OpenfabricCallback#onError()"})," is called, passing the reason for the error."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-kotlin",metastring:'title="Enroll Account"',children:"wallet.enrollAccount(context, sdk_tokenize_account_device_data), object : OpenfabricCallback<DigitizeAccountResponse> {\r\n  override fun onSuccess(response: DigitizeAccountResponse) {\r\n    // update provisioning state with enrollment succeeded\r\n  }\r\n\r\n  override fun onError(error: OpenFabricError) {\r\n    displayError(RuntimeException(error.message))\r\n  }\r\n})\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-kotlin",metastring:'title="CardListener.kt"',children:"class CardListener: CardEventListener {\r\n  override fun onCardsUpdated(context: Context) {\r\n    val intent = Intent(context, MainActivity::class.java)\r\n    intent.setAction(CardEventsReceiver.CARD_UPDATED)\r\n    LocalBroadcastManager.getInstance(context).sendBroadcast(intent)\r\n  }\r\n  ...\r\n}\n"})}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsxs)(n.p,{children:["The registration of the listener is done by declaring the listener class in your manifest file under the key ",(0,c.jsx)(n.code,{children:"co.openfabric.nfc.CardEventListener"}),", as shown below:"]})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-xml",metastring:'title="AndroidManifest.xml"',children:'<meta-data\r\n    android:name="co.openfabric.nfc.CardEventListener"            \r\n    android:value="mypackage.CardListener" />\n'})}),"\n",(0,c.jsxs)(n.p,{children:["After this step is done, you can continue with card activation and setting preference as described ",(0,c.jsx)(n.a,{href:"./ActivationPreferenceSettings",children:"here"})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}}}]);