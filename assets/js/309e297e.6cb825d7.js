"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[2587],{11470(e,t,n){n.d(t,{A:()=>S});var i=n(96540),r=n(34164),a=n(17559),s=n(23104),o=n(56347),c=n(205),l=n(57485),d=n(31682),u=n(70679);function h(e){var t,n;return null!=(t=null==(n=i.Children.toArray(e).filter(function(e){return"\n"!==e}).map(function(e){if(!e||(0,i.isValidElement)(e)&&((t=e.props)&&"object"==typeof t&&"value"in t))return e;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:n.filter(Boolean))?t:[]}function f(e){var t=e.values,n=e.children;return(0,i.useMemo)(function(){var e=null!=t?t:function(e){return h(e).map(function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}})}(n);return function(e){var t=(0,d.XI)(e,function(e,t){return e.value===t.value});if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map(function(e){return e.value}).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[t,n])}function p(e){var t=e.value;return e.tabValues.some(function(e){return e.value===t})}function x(e){var t=e.queryString,n=void 0!==t&&t,r=e.groupId,a=(0,o.W6)(),s=function(e){var t=e.queryString,n=void 0!==t&&t,i=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=i?i:null}({queryString:n,groupId:r});return[(0,l.aZ)(s),(0,i.useCallback)(function(e){if(s){var t=new URLSearchParams(a.location.search);t.set(s,e),a.replace(Object.assign({},a.location,{search:t.toString()}))}},[s,a])]}function b(e){var t,n,r,a,s=e.defaultValue,o=e.queryString,l=void 0!==o&&o,d=e.groupId,h=f(e),b=(0,i.useState)(function(){return function(e){var t,n=e.defaultValue,i=e.tabValues;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:i}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+i.map(function(e){return e.value}).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(t=i.find(function(e){return e.default}))?t:i[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:s,tabValues:h})}),m=b[0],j=b[1],g=x({queryString:l,groupId:d}),v=g[0],y=g[1],_=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:d}.groupId),n=(0,u.Dv)(t),r=n[0],a=n[1],[r,(0,i.useCallback)(function(e){t&&a.set(e)},[t,a])]),w=_[0],S=_[1],N=function(){var e=null!=v?v:w;return p({value:e,tabValues:h})?e:null}();return(0,c.A)(function(){N&&j(N)},[N]),{selectedValue:m,selectValue:(0,i.useCallback)(function(e){if(!p({value:e,tabValues:h}))throw new Error("Can't select invalid tab value="+e);j(e),y(e),S(e)},[y,S,h]),tabValues:h}}var m=n(92303);const j="tabList__CuJ",g="tabItem_LNqP";var v=n(74848);function y(e){var t=e.className,n=e.block,i=e.selectedValue,a=e.selectValue,o=e.tabValues,c=[],l=(0,s.a_)().blockElementScrollPositionUntilNextRender,d=function(e){var t=e.currentTarget,n=c.indexOf(t),r=o[n].value;r!==i&&(l(t),a(r))},u=function(e){var t,n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":var i,r=c.indexOf(e.currentTarget)+1;n=null!=(i=c[r])?i:c[0];break;case"ArrowLeft":var a,s=c.indexOf(e.currentTarget)-1;n=null!=(a=c[s])?a:c[c.length-1]}null==(t=n)||t.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:o.map(function(e){var t=e.value,n=e.label,a=e.attributes;return(0,v.jsx)("li",Object.assign({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,ref:function(e){c.push(e)},onKeyDown:u,onClick:d},a,{className:(0,r.A)("tabs__item",g,null==a?void 0:a.className,{"tabs__item--active":i===t}),children:null!=n?n:t}),t)})})}function _(e){var t=e.lazy,n=e.children,a=e.selectedValue,s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){var o=s.find(function(e){return e.props.value===a});return o?(0,i.cloneElement)(o,{className:(0,r.A)("margin-top--md",o.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:s.map(function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==a})})})}function w(e){var t=b(e);return(0,v.jsxs)("div",{className:(0,r.A)(a.G.tabs.container,"tabs-container",j),children:[(0,v.jsx)(y,Object.assign({},t,e)),(0,v.jsx)(_,Object.assign({},t,e))]})}function S(e){var t=(0,m.A)();return(0,v.jsx)(w,Object.assign({},e,{children:h(e.children)}),String(t))}},19365(e,t,n){n.d(t,{A:()=>s});n(96540);var i=n(34164);const r="tabItem_Ymn6";var a=n(74848);function s(e){var t=e.children,n=e.hidden,s=e.className;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.A)(r,s),hidden:n,children:t})}},28453(e,t,n){n.d(t,{R:()=>s,x:()=>o});var i=n(96540);const r={},a=i.createContext(r);function s(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:t},e.children)}},31631(e,t,n){n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"Getting-Started/Notifications","title":"Notifications","description":"Our notification systems send you real-time updates to your systems as they get generated. Open Fabric expects all notifications to be acknowledged with a 2xx HTTP Status Code and in the absence of which we will retry the notification.","source":"@site/docs/Getting-Started/Notifications.md","sourceDirName":"Getting-Started","slug":"/Getting-Started/Notifications","permalink":"/github.io/docs/Getting-Started/Notifications","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Getting Started","permalink":"/github.io/docs/tags/getting-started"},{"inline":true,"label":"Notifications","permalink":"/github.io/docs/tags/notifications"}],"version":"current","frontMatter":{"tags":["Getting Started","Notifications"]},"sidebar":"someSidebar","previous":{"title":"Reporting","permalink":"/github.io/docs/Getting-Started/Reporting"},"next":{"title":"SDKs and Reference App","permalink":"/github.io/docs/Getting-Started/SDKs"}}');var r=n(74848),a=n(28453),s=n(11470),o=n(19365);const c=n.p+"assets/images/webhook-diagram-1cae4d79f3de049e20e70e0903e99ae9.png",l={tags:["Getting Started","Notifications"]},d="Notifications",u={},h=[{value:"Notification delivery method",id:"notification-delivery-method",level:2},{value:"Automatic retries for failed notifications",id:"automatic-retries-for-failed-notifications",level:2},{value:"Webhook notification implementation guideline",id:"webhook-notification-implementation-guideline",level:2}];function f(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"notifications",children:"Notifications"})}),"\n",(0,r.jsx)(t.p,{children:"Our notification systems send you real-time updates to your systems as they get generated. Open Fabric expects all notifications to be acknowledged with a 2xx HTTP Status Code and in the absence of which we will retry the notification."}),"\n",(0,r.jsx)(t.p,{children:"In this section you can find further details on how you can implement webhook endpoints to consume our notifications and understand how our failed notification retry works."}),"\n",(0,r.jsx)(t.h2,{id:"notification-delivery-method",children:"Notification delivery method"}),"\n",(0,r.jsx)(t.p,{children:"Open Fabric sends notifications to you via POST requests to a pre-configured webhook endpoint defined by your system. This endpoint should be able to handle a dynamic request body to serve as a receiver for multiple types of notifications."}),"\n",(0,r.jsx)(t.p,{children:"Notifications can be sent in batches (as an array of notification objects), or as individual notification objects, depending on your webhook configuration."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Endpoint"}),": As configured by you"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Method"}),": POST"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Authentication"})," Custom header with shared API key, as configured by you"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Notification Request Body"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"notification_id"}),(0,r.jsx)(t.td,{children:"UUID"}),(0,r.jsx)(t.td,{children:"Notification ID"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"type"}),(0,r.jsx)(t.td,{children:"String"}),(0,r.jsxs)(t.td,{children:["Notification Type ",(0,r.jsx)("br",{})," Example: ",(0,r.jsx)(t.code,{children:"v1:pba:transaction:final_auth_reversed"}),(0,r.jsx)("br",{}),"The first section of the type indicates the version number of this notification payload."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"created_at"}),(0,r.jsx)(t.td,{children:"String"}),(0,r.jsx)(t.td,{children:"Notification creation timestamp, in ISO 8601 Date Time format"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"data"}),(0,r.jsx)(t.td,{children:"String"}),(0,r.jsxs)(t.td,{children:["Notification Payload ",(0,r.jsx)("br",{})," The schema of data depends on the notification type"]})]})]})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Sample Notification Requests"})}),"\n",(0,r.jsxs)(s.A,{children:[(0,r.jsx)(o.A,{value:"batch",label:"Batch Mode",default:!0,children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'[\r\n        {\r\n        "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n        "type": "v1:pba:transaction:final_auth_reversed",\r\n        "created_at": "2023-06-24T14:15:22Z",\r\n        "data": {\r\n            "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n            "transaction_id": "6182bde8-ee3e-4bd5-935e-e56507e0f809",\r\n            "tenant_reference_id": "31XXXX6723173606",\r\n            "network_transaction_ref": "awqcB1rPDuJIm4yKOQbqJUj5MvpdcH6E",\r\n            "network_message_ref": "CZLIzgNfeyMCabcsXp3liJPgSVGyQypHI2B",\r\n            "amount": 10.0,\r\n            "currency_code": "SGD",\r\n            "billing_amount": 10.0,\r\n            "billing_currency_code": "SGD",\r\n            "billing_exchange_rate": 1.0,\r\n            "settlement_amount": 10.0,\r\n            "settlement_currency_code": "SGD",\r\n            "settlement_exchange_rate": 1.0\r\n        }\r\n    },\r\n    {\r\n        "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n        "type": "v1:pba:transaction:pre_auth_reversed",\r\n        "created_at": "2023-06-24T14:15:22Z",\r\n        "data": {\r\n            "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n            "transaction_id": "6182bde8-ee3e-4bd5-935e-e56507e0f810",\r\n            "tenant_reference_id": "31XXXX6723173607",\r\n            "network_transaction_ref": "awqcB1rPDuJIm4yKOQbqJUj5MvpdcH6E",\r\n            "network_message_ref": "CZLIzgNfeyMCabcsXp3liJPgSVGyQypHI2C",\r\n            "amount": 50.0,\r\n            "currency_code": "SGD",\r\n            "billing_amount": 50.0,\r\n            "billing_currency_code": "SGD",\r\n            "billing_exchange_rate": 1.0,\r\n            "settlement_amount": 50.0,\r\n            "settlement_currency_code": "SGD",\r\n            "settlement_exchange_rate": 1.0\r\n        }\r\n    }\r\n]\n'})})}),(0,r.jsx)(o.A,{value:"individual",label:"Individual Mode",default:!0,children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\r\n    "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n    "type": "v1:pba:transaction:final_auth_reversed",\r\n    "created_at": "2023-06-24T14:15:22Z",\r\n    "data": {\r\n        "notification_id": "8bedf365-8442-4b6e-a480-7dad7b40ac44",\r\n        "transaction_id": "6182bde8-ee3e-4bd5-935e-e56507e0f809",\r\n        "tenant_reference_id": "31XXXX6723173606",\r\n        "network_transaction_ref": "awqcB1rPDuJIm4yKOQbqJUj5MvpdcH6E",\r\n        "network_message_ref": "CZLIzgNfeyMCabcsXp3liJPgSVGyQypHI2B",\r\n        "amount": 10.0,\r\n        "currency_code": "SGD",\r\n        "billing_amount": 10.0,\r\n        "billing_currency_code": "SGD",\r\n        "billing_exchange_rate": 1.0,\r\n        "settlement_amount": 10.0,\r\n        "settlement_currency_code": "SGD",\r\n        "settlement_exchange_rate": 1.0\r\n    }\r\n}\n'})})})]}),"\n",(0,r.jsx)(t.h2,{id:"automatic-retries-for-failed-notifications",children:"Automatic retries for failed notifications"}),"\n",(0,r.jsx)(t.p,{children:"In the scenario where you did not acknowledge our notifications (with a 2xx HTTP Status code - response body is not required), Open Fabric will employ an exponential retry strategy to redeliver the notification, capped at a maximum of 20 attempts."}),"\n",(0,r.jsx)(t.p,{children:"Our retries schedule is as follows:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Attempt"}),(0,r.jsx)(t.th,{children:"Delayed Seconds"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"1"}),(0,r.jsx)(t.td,{children:"0"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"2"}),(0,r.jsx)(t.td,{children:"30"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"3"}),(0,r.jsx)(t.td,{children:"78"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"4"}),(0,r.jsx)(t.td,{children:"154.800"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"5"}),(0,r.jsx)(t.td,{children:"277.680"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"6"}),(0,r.jsx)(t.td,{children:"474.288"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"7"}),(0,r.jsx)(t.td,{children:"788.861"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"8"}),(0,r.jsx)(t.td,{children:"1292.177"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"9"}),(0,r.jsx)(t.td,{children:"2097.484"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"10"}),(0,r.jsx)(t.td,{children:"3385.974"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"11"}),(0,r.jsx)(t.td,{children:"5447.558"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"12"}),(0,r.jsx)(t.td,{children:"8746.093"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"13"}),(0,r.jsx)(t.td,{children:"14023.749"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"14"}),(0,r.jsx)(t.td,{children:"22467.998"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"15"}),(0,r.jsx)(t.td,{children:"35978.797"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"16"}),(0,r.jsx)(t.td,{children:"57596.075"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"17"}),(0,r.jsx)(t.td,{children:"92183.720"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"18"}),(0,r.jsx)(t.td,{children:"147523.953"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"19"}),(0,r.jsx)(t.td,{children:"236068.324"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"20"}),(0,r.jsx)(t.td,{children:"377739.319"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"webhook-notification-implementation-guideline",children:"Webhook notification implementation guideline"}),"\n",(0,r.jsxs)(t.p,{children:["In this section, We will discuss an example architecture to implement a HTTP endpoint to receive notifications from Open Fabric which is fault tolerance and high availability. This architecture will involve a REST API framework (",(0,r.jsx)(t.em,{children:"Express.JS"}),"), a message queue broker (",(0,r.jsx)(t.em,{children:"ActiveMQ"}),"), a queue consumer written in ",(0,r.jsx)(t.em,{children:"Node.js"})," to consume notification messages, and a ",(0,r.jsx)(t.em,{children:"Postgres"})," database to store the notification messages."]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Setting up the Express.js"}),": Start by creating a new Express.js project by setting up necessary middlewares and routes using Express Route. The external system will be able to send HTTP notifications to these routes. When the Express.js application receives a notification, it should validate the data and then send it to ActiveMQ."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Integrating ActiveMQ"}),": Set up ActiveMQ which will act as the message broker in the architecture. Create a topic or queue in ActiveMQ. Once an http request hits Express.js application, the message from the http request is published to a corresponding queue on ActiveMQ based on the Notification type."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Creating Message Consumer"}),": Create a Node.js application that will act as the consumer of the messages published to the ActiveMQ queue. Using the STOMP or AMQP protocol, connect the Node.js application to ActiveMQ and subscribe it to the topic/queue to which Express.js is publishing. Whenever a new message is published to the topic/queue, this Node.js application should consume the message."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Process and Save Notifications to Postgres DB"}),": Once the Node.js application consumes messages from the ActiveMQ topic/queue and processes it, you should save those notifications to the PostgreSQL database for future debugging. To do this, set up a connection to the PostgreSQL database using a library (Node.js) such as ",(0,r.jsx)(t.code,{children:"pg-promise"})," or ",(0,r.jsx)(t.code,{children:"node-postgres"}),". Then save the notification payload to a table corresponding to its type."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Implementing Error Handling and Fault Tolerance"}),": You should set up multiple queue consumer instances to consume messages from the ActiveMQ to mitigate the risk of a single point of failure. If one instance of the consumer Node.js application fails, the Notification message will not be acknowledged. After that other instance will be able to consume and process that Notification message. Implement logging and error handling mechanisms in all stages of this data flow, so if anything fails, it can be easily diagnosed and fixed. You must always run at least 2 instances of Express.js API server to ensure High Availability. And remember to define HA-Policies for your ActiveMQ cluster configuration."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Security Considerations"}),": Secure your system by using HTTPS for your Express.js endpoints. Apply proper user authentication and authorization before the external system can send notifications to your Express.js endpoints. Ensure that your connection to ActiveMQ and PostgreSQL is secured and cannot be accessed by unauthorized parties."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The diagram below will help understand a sample architecture for the webhook notification endpoint implementation on your end."}),"\n",(0,r.jsx)("img",{src:c,alt:"Webhook notification architecture diagram"}),"\n",(0,r.jsx)(t.p,{children:"This is a high-level overview of the architecture. There should be additional components and processes may need to be involved as well. For example: A Ledger Service to handle query/update the customer credit balance and on-hold balance. A File Fetching Service to download the clearing files from Open Fabric (SFTP or AWS S3)"})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(f,{...e})}):f(e)}}}]);