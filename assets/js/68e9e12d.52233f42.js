"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[8739],{11470(e,n,r){r.d(n,{A:()=>k});var t=r(96540),a=r(34164),i=r(17559),s=r(23104),o=r(56347),c=r(205),d=r(57485),l=r(31682),u=r(70679);function h(e){var n,r;return null!=(n=null==(r=t.Children.toArray(e).filter(function(e){return"\n"!==e}).map(function(e){if(!e||(0,t.isValidElement)(e)&&((n=e.props)&&"object"==typeof n&&"value"in n))return e;var n;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:r.filter(Boolean))?n:[]}function p(e){var n=e.values,r=e.children;return(0,t.useMemo)(function(){var e=null!=n?n:function(e){return h(e).map(function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}})}(r);return function(e){var n=(0,l.XI)(e,function(e,n){return e.value===n.value});if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(function(e){return e.value}).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,r])}function m(e){var n=e.value;return e.tabValues.some(function(e){return e.value===n})}function b(e){var n=e.queryString,r=void 0!==n&&n,a=e.groupId,i=(0,o.W6)(),s=function(e){var n=e.queryString,r=void 0!==n&&n,t=e.groupId;if("string"==typeof r)return r;if(!1===r)return null;if(!0===r&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:r,groupId:a});return[(0,d.aZ)(s),(0,t.useCallback)(function(e){if(s){var n=new URLSearchParams(i.location.search);n.set(s,e),i.replace(Object.assign({},i.location,{search:n.toString()}))}},[s,i])]}function v(e){var n,r,a,i,s=e.defaultValue,o=e.queryString,d=void 0!==o&&o,l=e.groupId,h=p(e),v=(0,t.useState)(function(){return function(e){var n,r=e.defaultValue,t=e.tabValues;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!m({value:r,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+r+'" but none of its children has the corresponding value. Available values are: '+t.map(function(e){return e.value}).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return r}var a=null!=(n=t.find(function(e){return e.default}))?n:t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:s,tabValues:h})}),f=v[0],g=v[1],y=b({queryString:d,groupId:l}),x=y[0],j=y[1],P=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:l}.groupId),r=(0,u.Dv)(n),a=r[0],i=r[1],[a,(0,t.useCallback)(function(e){n&&i.set(e)},[n,i])]),w=P[0],k=P[1],S=function(){var e=null!=x?x:w;return m({value:e,tabValues:h})?e:null}();return(0,c.A)(function(){S&&g(S)},[S]),{selectedValue:f,selectValue:(0,t.useCallback)(function(e){if(!m({value:e,tabValues:h}))throw new Error("Can't select invalid tab value="+e);g(e),j(e),k(e)},[j,k,h]),tabValues:h}}var f=r(92303);const g="tabList__CuJ",y="tabItem_LNqP";var x=r(74848);function j(e){var n=e.className,r=e.block,t=e.selectedValue,i=e.selectValue,o=e.tabValues,c=[],d=(0,s.a_)().blockElementScrollPositionUntilNextRender,l=function(e){var n=e.currentTarget,r=c.indexOf(n),a=o[r].value;a!==t&&(d(n),i(a))},u=function(e){var n,r=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":var t,a=c.indexOf(e.currentTarget)+1;r=null!=(t=c[a])?t:c[0];break;case"ArrowLeft":var i,s=c.indexOf(e.currentTarget)-1;r=null!=(i=c[s])?i:c[c.length-1]}null==(n=r)||n.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":r},n),children:o.map(function(e){var n=e.value,r=e.label,i=e.attributes;return(0,x.jsx)("li",Object.assign({role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:function(e){c.push(e)},onKeyDown:u,onClick:l},i,{className:(0,a.A)("tabs__item",y,null==i?void 0:i.className,{"tabs__item--active":t===n}),children:null!=r?r:n}),n)})})}function P(e){var n=e.lazy,r=e.children,i=e.selectedValue,s=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){var o=s.find(function(e){return e.props.value===i});return o?(0,t.cloneElement)(o,{className:(0,a.A)("margin-top--md",o.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:s.map(function(e,n){return(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})})})}function w(e){var n=v(e);return(0,x.jsxs)("div",{className:(0,a.A)(i.G.tabs.container,"tabs-container",g),children:[(0,x.jsx)(j,Object.assign({},n,e)),(0,x.jsx)(P,Object.assign({},n,e))]})}function k(e){var n=(0,f.A)();return(0,x.jsx)(w,Object.assign({},e,{children:h(e.children)}),String(n))}},19365(e,n,r){r.d(n,{A:()=>s});r(96540);var t=r(34164);const a="tabItem_Ymn6";var i=r(74848);function s(e){var n=e.children,r=e.hidden,s=e.className;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(a,s),hidden:r,children:n})}},28453(e,n,r){r.d(n,{R:()=>s,x:()=>o});var t=r(96540);const a={},i=t.createContext(a);function s(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},72224(e,n,r){r.d(n,{A:()=>t});const t=r.p+"assets/images/card_handover_experience-014972d55bbc9ebda34e9b8769b3c581.png"},86081(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"OnlineOrchestration/PartnerIntegrationGuide-CardHandover","title":"\u2018Card Handover\u2019 Pattern - Reference Integration Guide","description":"1. Overview","source":"@site/docs/OnlineOrchestration/PartnerIntegrationGuide-CardHandover.mdx","sourceDirName":"OnlineOrchestration","slug":"/OnlineOrchestration/PartnerIntegrationGuide-CardHandover","permalink":"/github.io/docs/OnlineOrchestration/PartnerIntegrationGuide-CardHandover","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Documentation","permalink":"/github.io/docs/tags/documentation"},{"inline":true,"label":"Partner Integration Guide","permalink":"/github.io/docs/tags/partner-integration-guide"},{"inline":true,"label":"Partner SDK","permalink":"/github.io/docs/tags/partner-sdk"},{"inline":true,"label":"Integration Patterns","permalink":"/github.io/docs/tags/integration-patterns"},{"inline":true,"label":"Card Handover","permalink":"/github.io/docs/tags/card-handover"}],"version":"current","frontMatter":{"tags":["Documentation","Partner Integration Guide","Partner SDK","Integration Patterns","Card Handover"]},"sidebar":"someSidebar","previous":{"title":"Overview","permalink":"/github.io/docs/OnlineOrchestration/PartnerIntegration-Models"},"next":{"title":"PG Token Handover","permalink":"/github.io/docs/OnlineOrchestration/PartnerIntegrationGuide-PGTokenHandover"}}');var a=r(74848),i=r(28453),s=r(11470),o=r(19365);const c={tags:["Documentation","Partner Integration Guide","Partner SDK","Integration Patterns","Card Handover"]},d="\u2018Card Handover\u2019 Pattern - Reference Integration Guide",l={},u=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Integration Patterns",id:"2-integration-patterns",level:2},{value:"3. How <code>Card Handover</code> works",id:"3-how-card-handover-works",level:2},{value:"4. Customer Experience",id:"4-customer-experience",level:2},{value:"5. Customer Flow and System Interactions",id:"5-customer-flow-and-system-interactions",level:2},{value:"6. Integration Steps - Overview",id:"6-integration-steps---overview",level:2},{value:"7. Integration Steps - Deep Dive",id:"7-integration-steps---deep-dive",level:2},{value:"Step 1: Request Access Token (Server-side)",id:"step-1-request-access-token-server-side",level:3},{value:"Step 2: Initialize OpenFabric SDK for <code>Card Handover</code> (Client-side)",id:"step-2-initialize-openfabric-sdk-for-card-handover-client-side",level:3},{value:"2.1 Add dependency",id:"21-add-dependency",level:4},{value:"Step 2.2 Add Tenant\u2019s Payment Method Button",id:"step-22-add-tenants-payment-method-button",level:4},{value:"2.3 Initialize OpenFabric SDK for <code>PG Token</code> Handover",id:"23-initialize-openfabric-sdk-for-pg-token-handover",level:4},{value:"Step 3: Fetch and Process Card with Payment Gateway (Server-side)",id:"step-3-fetch-and-process-card-with-payment-gateway-server-side",level:3},{value:"Step 3.1. Generate a Card Fetch accessToken",id:"step-31-generate-a-card-fetch-accesstoken",level:4},{value:"Step 3.2. Fetch Card Details with Card Fetch accessToken",id:"step-32-fetch-card-details-with-card-fetch-accesstoken",level:4},{value:"Step 3.3. Process virtual card with Payment Gateway",id:"step-33-process-virtual-card-with-payment-gateway",level:4},{value:"8. Test and Go Live",id:"8-test-and-go-live",level:2},{value:"9. References",id:"9-references",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"card-handover-pattern---reference-integration-guide",children:"\u2018Card Handover\u2019 Pattern - Reference Integration Guide"})}),"\n",(0,a.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"OpenFabric"})," accelerates the adoption of a ",(0,a.jsx)(n.code,{children:"Payment Method"}),"(BNPLs, Wallets, etc.) offered by our ",(0,a.jsx)(n.code,{children:"Tenants"})," with their ",(0,a.jsx)(n.code,{children:"Partners"})," (Merchants, Payment Gateways, etc.) by simplifying the technical integration needed between them."]}),"\n",(0,a.jsx)(n.p,{children:"Traditional integration by a Partner to accept a Tenant's Payment Method requires changes to"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Frontend Order Management Flow to present the payment method to end customers and initiate transactions"}),"\n",(0,a.jsx)(n.li,{children:"Backend Order Management System to update order status after payment completion"}),"\n",(0,a.jsx)(n.li,{children:"Backend Finance System to reconcile settlement of funds against each order"}),"\n",(0,a.jsx)(n.li,{children:"Backend Customer Support System to query transaction status and issue refunds if needed"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"These changes are complex and typically take 3-4 months to implement, making accepting a new Payment Method by a Partner a time-consuming affair."}),"\n",(0,a.jsx)(n.p,{children:"With OpenFabric, our Tenants can drastically reduce the complexity and quantum of changes needed by a Partner to accept their Payment Method. With a simple integration using OpenFabric SDK, a Partner can initiate a transaction and redirect the customer to our Tenant's Payment Method for payment approval."}),"\n",(0,a.jsx)(n.p,{children:"OpenFabric generates and hands over a one-time virtual card to the Partner when our Tenant approves the payment. The Partner can reuse their existing card processing setup to charge this virtual card. Settlement of funds for the transaction will happen through their card processing setup."}),"\n",(0,a.jsx)(n.p,{children:"Even issuing refunds back to the customer can be simply initiated against this virtual card (without needing any direct integration between a Partner and the Payment Method)."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Reusing the existing card processing setup means the Partner does not need to build the custom backend changes traditionally required to accept the Payment Method. This simplification enables a Partner to integrate and accept a new Payment Method in 3-4 days instead of 3-4 months."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"2-integration-patterns",children:"2. Integration Patterns"}),"\n",(0,a.jsx)(n.p,{children:"Depending on the Partner\u2019s ability to handle card information, OpenFabric supports two different Integration Patterns to hand over the virtual card details."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"Card Handover"}),": The virtual card information is handed over to the Partner's backend in the clear (ideal for Partners that are PCI compliant, like Payment Gateways), (or)"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"PG(Payment Gateway) Token Handover"}),": A token generated by submitting the virtual card with the Partner\u2019s Payment Gateway is handed over to the Partner (ideal for Partners that are not PCI Compliant, usually Merchants)."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["This guide will look at how a Partner can integrate into an OpenFabric-powered Payment Method using the ",(0,a.jsx)(n.code,{children:"Card Handover"})," Integration Pattern."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"This integration pattern is ideal for Payment Gateways and Large Merchant Partners who are PCI compliant."}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"3-how-card-handover-works",children:["3. How ",(0,a.jsx)(n.code,{children:"Card Handover"})," works"]}),"\n",(0,a.jsx)(n.p,{children:"Some Partners (Very large merchants and Payment Gateways) are PCI Certified and can handle and process card details directly. For these Partners, OpenFabric can hand over the virtual card it has created for a transaction directly to the Partner\u2019s backend."}),"\n",(0,a.jsx)(n.p,{children:"The Partner can then charge the virtual card with their Payment Gateway of choice."}),"\n",(0,a.jsx)(n.p,{children:"Partners can issue refunds directly against the transaction that was processed with the virtual card to issue refunds."}),"\n",(0,a.jsx)(n.h2,{id:"4-customer-experience",children:"4. Customer Experience"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Backend Handover(Card) Integration Pattern - Sample Experience.png",src:r(72224).A+"",width:"1920",height:"1080"})}),"\n",(0,a.jsx)(n.h2,{id:"5-customer-flow-and-system-interactions",children:"5. Customer Flow and System Interactions"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\nparticipant Customer\r\nparticipant Partner(Web)\r\nparticipant Partner(Server)\r\nparticipant Partner's Payment Gateway\r\nparticipant OpenFabric / Payment Method\r\n\r\nCustomer ->>+ Partner(Web): Request Payment Page\r\nPartner(Web) ->>+ Partner(Server): Request Access Token\r\nrect rgb(255, 155, 55)\r\n  note right of Partner(Server): Step 1: Request Access Token\r\n  Partner(Server) ->> OpenFabric / Payment Method: Request accessToken\r\nend\r\nOpenFabric / Payment Method --\x3e> Partner(Server): accessToken\r\nPartner(Server) --\x3e>- Partner(Web): accessToken\r\n\r\n\r\nrect rgb(255, 155, 55)\r\n  note left of Partner(Web): Step 2: Initialize OpenFabric SDK <br>for Backend Handover(Card)####\r\n  Partner(Web) --\x3e>- Customer: Return Payment Page <br>w/ OpenFabric SDK\r\nend \r\n\r\nNote over Customer: Customer sees the Payment Page w/ <br>Tenant\u2019s Payment Method Button\r\nCustomer ->> OpenFabric / Payment Method: Payment intent with Payment Method (Customer clicks Tenant\u2019s Payment Method Button)\r\n\r\nNote over OpenFabric / Payment Method: Payment Method approves payment.<br> OpenFabric generates  a card <br>for the approved transaction\r\n\r\nOpenFabric / Payment Method --\x3e> Customer: paymentToken (w/ redirect instruction to Partner's Payment Page)\r\nCustomer --\x3e>+ Partner(Web): auto-redirect: Payment Page <br> w/ paymentToken\r\n\r\nrect rgb(255, 155, 55)\r\n  note right of Partner(Web): Step 3: Fetch and Process Card with PG\r\n  Partner(Web) ->>+ Partner(Server): process payment <br>w/ paymentToken \r\n  Partner(Server) ->>+ OpenFabric / Payment Method: Generate accessToken <br>to fetch Card details\r\n  OpenFabric / Payment Method --\x3e>- Partner(Server): Fetch Card accessToken\r\n  Partner(Server) ->>+ OpenFabric / Payment Method: Fetch Card details <br>w/ paymentToken\r\n  OpenFabric / Payment Method --\x3e>- Partner(Server): Card details\r\n  Note right of Partner(Server): After collecting card details,<br> process Card directly with PG\r\n  Partner(Server) ->+ Partner's Payment Gateway: Process collected card details with PG\r\n  Partner's Payment Gateway --\x3e>- Partner(Server): Payment Success\r\n  Partner(Server) --\x3e>- Partner(Web): Payment Success\r\n  Partner(Web) --\x3e>- Customer: Payment Success\r\nend"}),"\n",(0,a.jsx)(n.h2,{id:"6-integration-steps---overview",children:"6. Integration Steps - Overview"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Step"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-1-request-access-token-server-side",children:(0,a.jsx)(n.strong,{children:"Step 1: Request Acces Token"})})}),(0,a.jsx)(n.td,{children:"Partner generates an access token with their OpenFabric's Credentials (Client_ID and Client_Secret)."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-2-initialize-openfabric-sdk-for-card-handover-client-side",children:(0,a.jsxs)(n.strong,{children:["Step 2: Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"Card Handover"})]})})}),(0,a.jsx)(n.td,{children:"Partner includes and initializes OpenFabric SDK for 'Card Handover' when presenting the payment page."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-3-fetch-and-process-card-with-payment-gateway-server-side",children:(0,a.jsx)(n.strong,{children:"Step 3: Fetch and Process Card with Payment Gateway:"})})}),(0,a.jsx)(n.td,{children:"Partner should fetch the virtual card from OpenFabric, and charge it with their existing card processing setup."})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Once the card is processed successfully by their Payment Gateway, the Partner can send the customer a payment success message."}),"\n",(0,a.jsx)(n.h2,{id:"7-integration-steps---deep-dive",children:"7. Integration Steps - Deep Dive"}),"\n",(0,a.jsx)(n.h3,{id:"step-1-request-access-token-server-side",children:"Step 1: Request Access Token (Server-side)"}),"\n",(0,a.jsx)(n.p,{children:"Partner generates an access token using their OpenFabric's Credentials (Client_ID and Client_Secret). The access token is needed to initialize OpenFabric SDK."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Client_ID and Client_Secret are generated automatically when the Tenant onboards a partner on OpenFabric's platform."]}),"\n"]}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"js",label:"NodeJS",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const request = require('request');\r\n\r\nconst options = {\r\n  method: 'POST',\r\n  url: 'https://auth.sandbox.openfabric.co/oauth2/token',\r\n  headers: {\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n    /*\r\n     * Authorization header is base64 encoded value \r\n     * of your clientId and clientSecret\r\n    */ \r\n    Authorization: 'Basic dGVzdDp0ZXN0'\r\n  },\r\n  form: {\r\n    grant_type: 'client_credentials',\r\n    scope: 'resources/transactions.read resources/transactions.create'\r\n  }\r\n};\r\n\r\nrequest(options, function (error, response, body) {\r\n  if (error) throw new Error(error);\r\n\r\n  console.log(body);\r\n});\n"})})}),(0,a.jsx)(o.A,{value:"java",label:"Java",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'OkHttpClient client = new OkHttpClient();\r\n\r\nMediaType mediaType = MediaType.parse("application/x-www-form-urlencoded");\r\nRequestBody body = RequestBody.create(mediaType, "grant_type=client_credentials&scope=resources/transactions.read resources/transactions.create");\r\nRequest request = new Request.Builder()\r\n  .url("https://auth.sandbox.openfabric.co/oauth2/token")\r\n  .post(body)\r\n  .addHeader("Content-Type", "application/x-www-form-urlencoded")\r\n    /*\r\n     * Authorization header is base64 encoded value \r\n     * of your clientId and clientSecret\r\n    */ \r\n  .addHeader("Authorization", "Basic dGVzdDp0ZXN0")\r\n  .build();\r\n\r\nResponse response = client.newCall(request).execute();\n'})})}),(0,a.jsx)(o.A,{value:"bash",label:"Curl",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\r\n# Authorization header is base64 encoded value \r\n# of your clientId and clientSecret\r\n#     \r\ncurl --request POST \\\r\n  --url https://auth.sandbox.openfabric.co/oauth2/token \\\r\n  --header 'Authorization: Basic dGVzdDp0ZXN0' \\\r\n  --header 'Content-Type: application/x-www-form-urlencoded' \\\r\n  --data grant_type=client_credentials\r\n  --data-urlencode 'scope=resources/transactions.read resources/transactions.create'\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["Note: The URL would be ",(0,a.jsx)(n.code,{children:"https://auth.openfabric.co/oauth2/token"})," for production."]}),"\n",(0,a.jsx)(n.p,{children:"The response would be in the below format."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'{"access_token": ACCESS_TOKEN }\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"step-2-initialize-openfabric-sdk-for-card-handover-client-side",children:["Step 2: Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"Card Handover"})," (Client-side)"]}),"\n",(0,a.jsxs)(n.p,{children:["Partner will now initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover. To initialize OpenFabric SDK, the partner will need to pass"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Access token generated in Step 1"}),"\n",(0,a.jsx)(n.li,{children:"Order details"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"21-add-dependency",children:"2.1 Add dependency"}),"\n",(0,a.jsx)(n.p,{children:"Partner to include OpenFabric Partner SDK js as a dependency to their payment application."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",metastring:'title="Add Dependency"',children:'<script type="module" src="https://unpkg.com/@openfabric/merchant-sdk@1.0.0/dist/index.umd.min.js">\r\n<\/script>\n'})}),"\n",(0,a.jsx)(n.h4,{id:"step-22-add-tenants-payment-method-button",children:"Step 2.2 Add Tenant\u2019s Payment Method Button"}),"\n",(0,a.jsx)(n.p,{children:"Place tenant button and configure onClick handler for it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",metastring:'lineNumbers title="Add Tenant\u2019s Payment Method Button"',children:'<div id="tenant-button"> /*make this div the action button to initiate the transaction*/ </div> \n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'lineNumbers title="onClick handler"',children:'let tenantButton = document.getElementById("tenant-button");\r\n \r\nopenFabric.initialize().then(() => {\r\n    tenantButton.disabled = false;\r\n});\r\n \r\ntenantButton.onclick = function () {\r\n    if (tenantButton.disabled) {\r\n        return;\r\n    }\r\n    tenantButton.onclick = null; // to avoid double-click\r\n    openFabric.startFlow();\r\n};\n'})}),"\n",(0,a.jsxs)(n.h4,{id:"23-initialize-openfabric-sdk-for-pg-token-handover",children:["2.3 Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover"]}),"\n",(0,a.jsx)(n.p,{children:"Partner to initialize now initialize the OpenFabric SDK now."}),"\n",(0,a.jsxs)(n.p,{children:["Initializing OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token Handover"})," will require"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"an access token (generated in step 1),"}),"\n",(0,a.jsx)(n.li,{children:"order details - customer billing/shipping info, etc. ("}),"\n",(0,a.jsx)(n.li,{children:"Callback URLs - success and failure URLs, etc.,"}),"\n",(0,a.jsx)(n.li,{children:"information about their Payment Gateway"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Sample of initializing SDK is below."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'lineNumbers title="Initialize SDK"',children:'// Import Config and FillConfig from our SDK\r\nimport { OpenFabric } from "@openfabric/merchant-sdk"\r\n\r\nconst openFabric = OpenFabric(\r\n    access_token,\r\n    "https://acme-merchant.com/payment-success",// Success redirect url \r\n    "https://acme-merchant.com/payment-failed" // Failure redirect url\r\n)\r\n    .setEnvironment(Environment.production) // use Environment.sandbox to run test transactions. \r\n \r\nconst customer_info = {\r\n    mobile_number: "+632 8855 8800",\r\n    first_name: "John",\r\n    email: "john.doe@gmail.com",\r\n};\r\nconst item = {\r\n    item_id: "P100-1222",\r\n    name: "iPhone",\r\n    variation_name: "Black, 128GB",\r\n    description: "string",\r\n    quantity: 1,\r\n    amount: 1,\r\n    price: 2100.50,\r\n    original_price: 2300,\r\n    categories: ["phone"],\r\n};\r\n \r\nconst address_line_1 = "30th Street corner 11th Avenue Bonifacio Global City, Lane P, Taguig, 1634 Metro Manila";\r\nconst post_code = "1634";\r\n \r\nconst shipping_address = {\r\n    country_code: "ph",\r\n    address_line_1,\r\n    post_code,\r\n};\r\n \r\nconst billing_address = {\r\n    country_code: "ph",\r\n    address_line_1,\r\n    post_code,\r\n};\r\n \r\nconst partner_reference_id = "142134235" // Merchant\u2019s transaction reference ID/Order ID.\r\n \r\nopenFabric.createOrder({\r\n        customer_info,\r\n        amount: 2100.50,\r\n        currency: "PHP",\r\n        partner_reference_id,\r\n        transaction_details: {\r\n            shipping_address,\r\n            billing_address,\r\n            items: [item], // When there are multiple items, the total of all item.price should add up to the amount above. \r\n        },\r\n});\n'})}),"\n",(0,a.jsx)(n.p,{children:"OpenFabric SDK will redirect to the Payment Method's payment approval flow when a customer clicks on the payment button."}),"\n",(0,a.jsx)(n.h3,{id:"step-3-fetch-and-process-card-with-payment-gateway-server-side",children:"Step 3: Fetch and Process Card with Payment Gateway (Server-side)"}),"\n",(0,a.jsx)(n.p,{children:"OpenFabric SDK will generate a secure, one-time-use virtual card specific to this transaction when the Payment Method successfully approves a transaction. A token that identifies this card is sent back to the Partner as part of the  (and webhook notifications)."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'const queryParams = new URLSearchParams(window.location.search);\r\nconst card_token = queryParams.get("txn_card_token");\r\n// Pass card_token to the backend\n'})}),"\n",(0,a.jsx)(n.p,{children:"The Partner can fetch the virtual card details using the above token. To fetch the card details, they must authenticate again and get an access token. These are covered in steps 3.1 and 3.2 below."}),"\n",(0,a.jsx)(n.h4,{id:"step-31-generate-a-card-fetch-accesstoken",children:"Step 3.1. Generate a Card Fetch accessToken"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"js",label:"NodeJS",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const request = require('request');\r\n\r\nconst options = {\r\n  method: 'POST',\r\n  url: 'https://auth.sandbox.openfabric.co/oauth2/token',\r\n  headers: {\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n    /*\r\n     * Authorization header is base64 encoded value \r\n     * of your clientId and clientSecret\r\n    */ \r\n    Authorization: 'Basic dGVzdDp0ZXN0'\r\n  },\r\n  form: {\r\n    grant_type: 'client_credentials',\r\n    scope: 'resources/cards.read'\r\n  }\r\n};\r\n\r\nrequest(options, function (error, response, body) {\r\n  if (error) throw new Error(error);\r\n\r\n  console.log(body);\r\n});\n"})})}),(0,a.jsx)(o.A,{value:"java",label:"Java",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'OkHttpClient client = new OkHttpClient();\r\n\r\nMediaType mediaType = MediaType.parse("application/x-www-form-urlencoded");\r\nRequestBody body = RequestBody.create(mediaType, "grant_type=client_credentials&scope=resources/cards.read");\r\nRequest request = new Request.Builder()\r\n  .url("https://auth.sandbox.openfabric.co/oauth2/token")\r\n  .post(body)\r\n  .addHeader("Content-Type", "application/x-www-form-urlencoded")\r\n    /*\r\n     * Authorization header is base64 encoded value \r\n     * of your clientId and clientSecret\r\n    */ \r\n  .addHeader("Authorization", "Basic dGVzdDp0ZXN0")\r\n  .build();\r\n\r\nResponse response = client.newCall(request).execute();\n'})})}),(0,a.jsx)(o.A,{value:"bash",label:"Curl",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\r\n# Authorization header is base64 encoded value \r\n# of your clientId and clientSecret\r\n#     \r\ncurl --request POST \\\r\n  --url https://auth.sandbox.openfabric.co/oauth2/token \\\r\n  --header 'Authorization: Basic dGVzdDp0ZXN0' \\\r\n  --header 'Content-Type: application/x-www-form-urlencoded' \\\r\n  --data-urlencode  'grant_type=client_credentials' \\ \r\n  --data-urlencode 'scope=resources/cards.read'\n"})})})]}),"\n",(0,a.jsx)(n.h4,{id:"step-32-fetch-card-details-with-card-fetch-accesstoken",children:"Step 3.2. Fetch Card Details with Card Fetch accessToken"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"js",label:"NodeJS",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"var request = require('request');\r\nvar options = {\r\n  'method': 'POST',\r\n  'url': 'https://issuer.sandbox.openfabric.co/i/fetchCard',\r\n  'headers': {\r\n    'authorization': 'Bearer <access_token from 3.1>',\r\n    'dnt': '1',\r\n    'content-type': 'application/json',\r\n  },\r\n  body: JSON.stringify({\r\n    \"card_fetch_token\": \"< card_token handover from FE>\"\r\n  })\r\n\r\n};\r\nrequest(options, function (error, response) {\r\n  if (error) throw new Error(error);\r\n  console.log(response.body);\r\n});\n"})})}),(0,a.jsx)(o.A,{value:"java",label:"Java",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'OkHttpClient client = new OkHttpClient().newBuilder()\r\n  .build();\r\nMediaType mediaType = MediaType.parse("application/json");\r\nRequestBody body = RequestBody.create(mediaType, "{\\"card_fetch_token\\":\\"<card_fetch_token>\\"}");\r\nRequest request = new Request.Builder()\r\n  .url("https://issuer.sandbox.openfabric.co/i/fetchCard")\r\n  .method("POST", body)\r\n  .addHeader("authorization", "Bearer <access_token from 3.1>")\r\n  .addHeader("content-type", "application/json")\r\n  .build();\r\nResponse response = client.newCall(request).execute();\n'})})}),(0,a.jsx)(o.A,{value:"bash",label:"Curl",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl --location --request POST 'https://issuer.sandbox.openfabric.co/i/fetchCard' \\\r\n--header 'authorization: Bearer <access_token from 3.1>' \\\r\n--header 'content-type: application/json' \\\r\n--data-raw '{\"card_fetch_token\":\"<card_token handover from FE>\"}'\n"})})})]}),"\n",(0,a.jsx)(n.h4,{id:"step-33-process-virtual-card-with-payment-gateway",children:"Step 3.3. Process virtual card with Payment Gateway"}),"\n",(0,a.jsx)(n.p,{children:"The partner should now charge this virtual card with their Payment Gateway (or card processing backend)."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," If the Tenant declines a transaction, OpenFabric will redirect to the cancel URL specified as part of SDK initialization. Partner is advised to present other viable ways to pay for their customers."]}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"To issue refunds to the customer"}),", Partner simply has initiate a refund against the card with their Payment Gateway (or card processing backend)."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"8-test-and-go-live",children:"8. Test and Go Live"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Partner's Client_ID and Client_Secret (keys) are available in Tenant Servicing Portal (Sandbox and production will have different keys)."}),"\n",(0,a.jsx)(n.li,{children:"Use keys from Sandbox's Tenant Servicing Portal to test transactions against our sandbox and keys from Production's Tenant Servicing Portal to run transactions against our production environment."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"9-references",children:"9. References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/open-fabric/openfabric-integration-samples",children:"Integration Samples"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);