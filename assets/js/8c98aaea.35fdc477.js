"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[9135],{3239(e,n,t){t.d(n,{A:()=>r});const r=t.p+"assets/images/pg_token_handover_experience-c5d4f3e0ae62a04ef7cc52f71cd0423b.png"},11470(e,n,t){t.d(n,{A:()=>w});var r=t(96540),a=t(34164),i=t(17559),s=t(23104),o=t(56347),c=t(205),d=t(57485),l=t(31682),h=t(70679);function u(e){var n,t;return null!=(n=null==(t=r.Children.toArray(e).filter(function(e){return"\n"!==e}).map(function(e){if(!e||(0,r.isValidElement)(e)&&((n=e.props)&&"object"==typeof n&&"value"in n))return e;var n;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:t.filter(Boolean))?n:[]}function p(e){var n=e.values,t=e.children;return(0,r.useMemo)(function(){var e=null!=n?n:function(e){return u(e).map(function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}})}(t);return function(e){var n=(0,l.XI)(e,function(e,n){return e.value===n.value});if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(function(e){return e.value}).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,t])}function m(e){var n=e.value;return e.tabValues.some(function(e){return e.value===n})}function g(e){var n=e.queryString,t=void 0!==n&&n,a=e.groupId,i=(0,o.W6)(),s=function(e){var n=e.queryString,t=void 0!==n&&n,r=e.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:t,groupId:a});return[(0,d.aZ)(s),(0,r.useCallback)(function(e){if(s){var n=new URLSearchParams(i.location.search);n.set(s,e),i.replace(Object.assign({},i.location,{search:n.toString()}))}},[s,i])]}function v(e){var n,t,a,i,s=e.defaultValue,o=e.queryString,d=void 0!==o&&o,l=e.groupId,u=p(e),v=(0,r.useState)(function(){return function(e){var n,t=e.defaultValue,r=e.tabValues;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+r.map(function(e){return e.value}).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var a=null!=(n=r.find(function(e){return e.default}))?n:r[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:s,tabValues:u})}),b=v[0],P=v[1],f=g({queryString:d,groupId:l}),x=f[0],y=f[1],j=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:l}.groupId),t=(0,h.Dv)(n),a=t[0],i=t[1],[a,(0,r.useCallback)(function(e){n&&i.set(e)},[n,i])]),k=j[0],w=j[1],T=function(){var e=null!=x?x:k;return m({value:e,tabValues:u})?e:null}();return(0,c.A)(function(){T&&P(T)},[T]),{selectedValue:b,selectValue:(0,r.useCallback)(function(e){if(!m({value:e,tabValues:u}))throw new Error("Can't select invalid tab value="+e);P(e),y(e),w(e)},[y,w,u]),tabValues:u}}var b=t(92303);const P="tabList__CuJ",f="tabItem_LNqP";var x=t(74848);function y(e){var n=e.className,t=e.block,r=e.selectedValue,i=e.selectValue,o=e.tabValues,c=[],d=(0,s.a_)().blockElementScrollPositionUntilNextRender,l=function(e){var n=e.currentTarget,t=c.indexOf(n),a=o[t].value;a!==r&&(d(n),i(a))},h=function(e){var n,t=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":var r,a=c.indexOf(e.currentTarget)+1;t=null!=(r=c[a])?r:c[0];break;case"ArrowLeft":var i,s=c.indexOf(e.currentTarget)-1;t=null!=(i=c[s])?i:c[c.length-1]}null==(n=t)||n.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:o.map(function(e){var n=e.value,t=e.label,i=e.attributes;return(0,x.jsx)("li",Object.assign({role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:function(e){c.push(e)},onKeyDown:h,onClick:l},i,{className:(0,a.A)("tabs__item",f,null==i?void 0:i.className,{"tabs__item--active":r===n}),children:null!=t?t:n}),n)})})}function j(e){var n=e.lazy,t=e.children,i=e.selectedValue,s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){var o=s.find(function(e){return e.props.value===i});return o?(0,r.cloneElement)(o,{className:(0,a.A)("margin-top--md",o.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:s.map(function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==i})})})}function k(e){var n=v(e);return(0,x.jsxs)("div",{className:(0,a.A)(i.G.tabs.container,"tabs-container",P),children:[(0,x.jsx)(y,Object.assign({},n,e)),(0,x.jsx)(j,Object.assign({},n,e))]})}function w(e){var n=(0,b.A)();return(0,x.jsx)(k,Object.assign({},e,{children:u(e.children)}),String(n))}},19365(e,n,t){t.d(n,{A:()=>s});t(96540);var r=t(34164);const a="tabItem_Ymn6";var i=t(74848);function s(e){var n=e.children,t=e.hidden,s=e.className;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(a,s),hidden:t,children:n})}},28453(e,n,t){t.d(n,{R:()=>s,x:()=>o});var r=t(96540);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}},38326(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"OnlineOrchestration/PartnerIntegrationGuide-PGTokenHandover","title":"\'PG Token Handover\' Pattern - Reference Integration Guide","description":"1. Overview","source":"@site/docs/OnlineOrchestration/PartnerIntegrationGuide-PGTokenHandover.mdx","sourceDirName":"OnlineOrchestration","slug":"/OnlineOrchestration/PartnerIntegrationGuide-PGTokenHandover","permalink":"/github.io/docs/OnlineOrchestration/PartnerIntegrationGuide-PGTokenHandover","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Documentation","permalink":"/github.io/docs/tags/documentation"},{"inline":true,"label":"Partner Integration Guide","permalink":"/github.io/docs/tags/partner-integration-guide"},{"inline":true,"label":"Partner SDK","permalink":"/github.io/docs/tags/partner-sdk"},{"inline":true,"label":"Integration Patterns","permalink":"/github.io/docs/tags/integration-patterns"},{"inline":true,"label":"PG Token Handover","permalink":"/github.io/docs/tags/pg-token-handover"}],"version":"current","frontMatter":{"tags":["Documentation","Partner Integration Guide","Partner SDK","Integration Patterns","PG Token Handover"]},"sidebar":"someSidebar","previous":{"title":"Card Handover","permalink":"/github.io/docs/OnlineOrchestration/PartnerIntegrationGuide-CardHandover"}}');var a=t(74848),i=t(28453),s=t(11470),o=t(19365);const c={tags:["Documentation","Partner Integration Guide","Partner SDK","Integration Patterns","PG Token Handover"]},d="'PG Token Handover' Pattern - Reference Integration Guide",l={},h=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Integration Patterns",id:"2-integration-patterns",level:2},{value:"3. How <code>PG Token Handover</code> works",id:"3-how-pg-token-handover-works",level:2},{value:"4. Supported Payment Gateways for <code>PG Token Handover</code>",id:"4-supported-payment-gateways-for-pg-token-handover",level:2},{value:"5. Customer Experience",id:"5-customer-experience",level:2},{value:"6. Interaction Diagram",id:"6-interaction-diagram",level:2},{value:"7. Integration Steps - Overview",id:"7-integration-steps---overview",level:2},{value:"8. Integration Steps - Deep Dive",id:"8-integration-steps---deep-dive",level:2},{value:"Step 1: Request Access token (Server-side)",id:"step-1-request-access-token-server-side",level:3},{value:"Step 2: Initialize OpenFabric SDK for <code>PG Token</code> Handover (Client-side)",id:"step-2-initialize-openfabric-sdk-for-pg-token-handover-client-side",level:3},{value:"2.1 Add dependency",id:"21-add-dependency",level:4},{value:"Step 2.2 Add Tenant\u2019s Payment Method Button",id:"step-22-add-tenants-payment-method-button",level:4},{value:"2.3 Initialize OpenFabric SDK for <code>PG Token</code> Handover",id:"23-initialize-openfabric-sdk-for-pg-token-handover",level:4},{value:"Step 3: Fetch and Process <code>PG Token</code> with PG",id:"step-3-fetch-and-process-pg-token-with-pg",level:3},{value:"9. Test and Go Live",id:"9-test-and-go-live",level:2},{value:"10. References",id:"10-references",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"pg-token-handover-pattern---reference-integration-guide",children:"'PG Token Handover' Pattern - Reference Integration Guide"})}),"\n",(0,a.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"OpenFabric"})," accelerates the adoption of a ",(0,a.jsx)(n.code,{children:"Payment Method"}),"(BNPLs, Wallets, etc.) offered by our ",(0,a.jsx)(n.code,{children:"Tenants"})," with their ",(0,a.jsx)(n.code,{children:"Partners"})," (Merchants, Payment Gateways, etc.) by simplifying the technical integration needed between them."]}),"\n",(0,a.jsx)(n.p,{children:"Traditional integration by a Partner to accept a Tenant's Payment Method requires changes to"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Frontend Order Management Flow to present the payment method to end customers and initiate transactions"}),"\n",(0,a.jsx)(n.li,{children:"Backend Order Management System to update order status after payment completion"}),"\n",(0,a.jsx)(n.li,{children:"Backend Finance System to reconcile settlement of funds against each order"}),"\n",(0,a.jsx)(n.li,{children:"Backend Customer Support System to query transaction status and issue refunds if needed"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"These changes are complex and typically take 3-4 months to implement, making accepting a new Payment Method by a Partner a time-consuming affair."}),"\n",(0,a.jsx)(n.p,{children:"With OpenFabric, our Tenants can drastically reduce the complexity and quantum of changes needed by a Partner to accept their Payment Method. With a simple integration using OpenFabric SDK, a Partner can initiate a transaction and redirect the customer to our Tenant's Payment Method for payment approval."}),"\n",(0,a.jsx)(n.p,{children:"OpenFabric generates and hands over a one-time virtual card to the Partner when our Tenant approves the payment. The Partner can reuse their existing card processing setup to charge this virtual card. Settlement of funds for the transaction will happen through their card processing setup."}),"\n",(0,a.jsx)(n.p,{children:"Even issuing refunds back to the customer can be simply initiated against this virtual card (without needing any direct integration between a Partner and the Payment Method)."}),"\n",(0,a.jsx)(n.p,{children:"Reusing the existing card processing setup means the Partner does not need to build the custom backend changes traditionally required to accept our Tenant's Payment Method. This simplification enables a Partner to integrate and accept a new Payment Method in 3-4 days instead of 3-4 months."}),"\n",(0,a.jsx)(n.h2,{id:"2-integration-patterns",children:"2. Integration Patterns"}),"\n",(0,a.jsx)(n.p,{children:"Depending on the Partner\u2019s ability to handle card information, OpenFabric supports two different Integration Patterns to hand over the virtual card details."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"Card Handover"}),": The virtual card information is handed over to the Partner's backend (ideal for Partners that are PCI compliant), (or)"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"PG(Payment Gateway) Token Handover"}),": A token generated by submitting the virtual card with the Partner\u2019s Payment Gateway is handed over to the Partner (ideal for Partners that are not PCI Compliant)."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This guide will look at how a Partner can integrate into an OpenFabric-powered Payment Method using the PG Token Handover Integration Pattern."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"This integration pattern is ideal for Merchant Partners who are not PCI compliant."}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"3-how-pg-token-handover-works",children:["3. How ",(0,a.jsx)(n.code,{children:"PG Token Handover"})," works"]}),"\n",(0,a.jsxs)(n.p,{children:["Most Partners are not PCI Certified and cannot handle card details directly. To ensure that Partners have a PCI-compliant way to access the virtual card details, OpenFabric connects to the Payment Gateway used by the Partner, submits the virtual card it has for a transaction to the Payment Gateway, and generates a token (aka ",(0,a.jsx)(n.code,{children:"PG Token"}),") for the virtual card."]}),"\n",(0,a.jsxs)(n.p,{children:["Using a PCI-compliant ",(0,a.jsx)(n.code,{children:"PG Token"})," eliminates the need for Partners to be PCI-compliant. This ",(0,a.jsx)(n.code,{children:"PG Token"})," is handed over to the Partner. The Partner can then use the ",(0,a.jsx)(n.code,{children:"PG Token"})," with their Payment Gateway and charge the virtual card using the PG Token."]}),"\n",(0,a.jsxs)(n.p,{children:["Partners can issue refunds directly against the transactions they ran with the ",(0,a.jsx)(n.code,{children:"PG Token."})]}),"\n",(0,a.jsxs)(n.h2,{id:"4-supported-payment-gateways-for-pg-token-handover",children:["4. Supported Payment Gateways for ",(0,a.jsx)(n.code,{children:"PG Token Handover"})]}),"\n",(0,a.jsxs)(n.p,{children:["OpenFabric directly connects with the following Payment Gateways to create a ",(0,a.jsx)(n.code,{children:"PG Token"}),". We can only support ",(0,a.jsx)(n.code,{children:"PG Token Handover"})," with Partners using any of these Payment Gateways only for card processing."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Stripe ",(0,a.jsx)(n.code,{children:"name: stripe"})]}),"\n",(0,a.jsxs)(n.li,{children:["Xendit ",(0,a.jsx)(n.code,{children:"name: xendit"})]}),"\n",(0,a.jsxs)(n.li,{children:["PayMaya ",(0,a.jsx)(n.code,{children:"name: paymaya"})]}),"\n",(0,a.jsxs)(n.li,{children:["PayMongo ",(0,a.jsx)(n.code,{children:"name: paymongo"})]}),"\n",(0,a.jsxs)(n.li,{children:["Checkout.com ",(0,a.jsx)(n.code,{children:"name: checkout"})]}),"\n",(0,a.jsxs)(n.li,{children:["Omise ",(0,a.jsx)(n.code,{children:"name: omise"})]}),"\n",(0,a.jsxs)(n.li,{children:["Adyen ",(0,a.jsx)(n.code,{children:"name: adyen"})]}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"We will expand the above list as we connect directly with more Payment Gateways."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"5-customer-experience",children:"5. Customer Experience"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Backend Handover(PG Token) Integration Pattern - Sample Experience.png",src:t(3239).A+"",width:"1920",height:"1080"})}),"\n",(0,a.jsx)(n.h2,{id:"6-interaction-diagram",children:"6. Interaction Diagram"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\nparticipant Customer\r\nparticipant Partner(Web)\r\nparticipant Partner(Server)\r\nparticipant Partner's Payment Gateway\r\nparticipant OpenFabric / Tenant's Payment Method\r\n\r\n\r\nCustomer ->>+ Partner(Web): Request Payment Page\r\nPartner(Web) ->>+ Partner(Server): Request Access Token\r\nrect rgb(255, 155, 55)\r\n  note right of Partner(Server): Step 1: Request Access Token\r\n  Partner(Server) ->> OpenFabric / Tenant's Payment Method: Request accessToken\r\nend\r\nOpenFabric / Tenant's Payment Method --\x3e> Partner(Server): accessToken\r\nPartner(Server) --\x3e>- Partner(Web): accessToken\r\n\r\n\r\nrect rgb(255, 155, 55)\r\n  note left of Partner(Web): Step 2: Initialize OpenFabric SDK <br>for Backend Handover(PG Token)####\r\n  Partner(Web) --\x3e>- Customer: Return Payment Page <br>w/ OpenFabric SDK\r\nend \r\n\r\nNote over Customer: Customer see Payment Page w/ <br>Tenant's Payment Method button\r\nCustomer ->> OpenFabric / Tenant's Payment Method: Payment intent with Tenant's Payment Method (Customer clicks Tenant's Payment Method Button)\r\n\r\nNote over OpenFabric / Tenant's Payment Method: Tenant's Payment Method approves payment.<br> OpenFabric generates a virtual card <br>for the approved transaction\r\n\r\nOpenFabric / Tenant's Payment Method ->> Partner's Payment Gateway: Create PG Token for virtual card\r\nPartner's Payment Gateway --\x3e> OpenFabric / Tenant's Payment Method: PG Token\r\n\r\nOpenFabric / Tenant's Payment Method --\x3e> Customer: pgToken (w/ redirect instruction to Partner's Payment Page)\r\nCustomer --\x3e>+ Partner(Web): auto-redirect: Payment Page <br> w/ paymentToken\r\n\r\nrect rgb(255, 155, 55)\r\n  note right of Partner(Web): Step 3: Process PG token <br>w/ Payment Gateway\r\n  Partner(Web) ->> Partner's Payment Gateway: Process PG token with Payment Gateway\r\n  Partner's Payment Gateway --\x3e> Partner(Web): Payment Success\r\n  Partner(Web) --\x3e>- Customer: Payment Success\r\nend"}),"\n",(0,a.jsx)(n.h2,{id:"7-integration-steps---overview",children:"7. Integration Steps - Overview"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Step"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-1-request-access-token-server-side",children:(0,a.jsx)(n.strong,{children:"Step 1: Request Acces token"})})}),(0,a.jsx)(n.td,{children:"Partner generates an access token with their OpenFabric's Credentials (Client_ID and Client_Secret)."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-2-initialize-openfabric-sdk-for-pg-token-handover-client-side",children:(0,a.jsxs)(n.strong,{children:["Step 2: Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover"]})})}),(0,a.jsx)(n.td,{children:"Partner includes and initializes OpenFabric SDK for 'PG Token' handover when presenting the payment page."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"#step-3-fetch-and-process-card-with-pg",children:(0,a.jsxs)(n.strong,{children:["Step 3: Process ",(0,a.jsx)(n.code,{children:"PG Token"})," with Payment Gateway:"]})})}),(0,a.jsxs)(n.td,{children:["OpenFabric hands over a ",(0,a.jsx)(n.code,{children:"PG Token"}),", which it generated from the Partner's Payment Gateway using the one-time use virtual card for the transaction. Partners will need to simply charge the card with their Payment Gateway using the ",(0,a.jsx)(n.code,{children:"PG Token"}),"."]})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Once the card is changed successfully, the Partner can send the customer a payment success message."}),"\n",(0,a.jsx)(n.h2,{id:"8-integration-steps---deep-dive",children:"8. Integration Steps - Deep Dive"}),"\n",(0,a.jsx)(n.h3,{id:"step-1-request-access-token-server-side",children:"Step 1: Request Access token (Server-side)"}),"\n",(0,a.jsx)(n.p,{children:"Partner generates an access token using their OpenFabric's Credentials (Client_ID and Client_Secret). An access token is needed to initialize OpenFabric SDK."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Client_ID and Client_Secret are generated automatically when the Tenant onboards a partner on OpenFabric's platform."]}),"\n"]}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsx)(o.A,{value:"js",label:"NodeJS",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"#\r\n# Authorization header is base64 encoded value \r\n# of your Client_ID and Client_Secret\r\n\r\nvar request = require('request');\r\nvar options = {\r\n  'method': 'POST',\r\n  'url': 'https://auth.openfabric.co/oauth2/token',\r\n  'headers': {\r\n    'Authorization': 'Basic MTdjMDFrN3VlaDZsYzJq',\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n  },\r\n  form: {\r\n    'grant_type': 'client_credentials',\r\n    'scope': 'resources/transactions.read resources/transactions.create'\r\n  }\r\n};\r\nrequest(options, function (error, response) {\r\n  if (error) throw new Error(error);\r\n  console.log(response.body);\r\n});\n"})})}),(0,a.jsx)(o.A,{value:"java",label:"Java",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'#\r\n# Authorization header is base64 encoded value \r\n# of your Client_ID and Client_Secret\r\n#    \r\nOkHttpClient client = new OkHttpClient().newBuilder()\r\n  .build();\r\nMediaType mediaType = MediaType.parse("application/x-www-form-urlencoded");\r\nRequestBody body = RequestBody.create(mediaType, "grant_type=client_credentials&scope=resources/transactions.read resources/transactions.create");\r\nRequest request = new Request.Builder()\r\n  .url("https://auth.openfabric.co/oauth2/token")\r\n  .method("POST", body)\r\n  .addHeader("Authorization", "Basic MTdjMDFrN3VlaDZsYzJq")\r\n  .addHeader("Content-Type", "application/x-www-form-urlencoded")\r\n  .build();\r\nResponse response = client.newCall(request).execute();\n'})})}),(0,a.jsx)(o.A,{value:"bash",label:"Curl",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\r\n# Authorization header is base64 encoded value \r\n# of your Client_ID and Client_Secret\r\n#     \r\ncurl --location --request POST 'https://auth.openfabric.co/oauth2/token' \\\r\n--header 'Authorization: Basic MTdjMDFrN3VlaDZsYzJq' \\\r\n--header 'Content-Type: application/x-www-form-urlencoded' \\\r\n--data-urlencode 'grant_type=client_credentials' \\\r\n--data-urlencode 'scope=resources/transactions.read resources/transactions.create'\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["Note: The URL would be ",(0,a.jsx)(n.code,{children:"https://auth.openfabric.co/oauth2/token"})," for production."]}),"\n",(0,a.jsx)(n.p,{children:"The response would be in the below format."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'{"access_token": ACCESS_TOKEN }\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"step-2-initialize-openfabric-sdk-for-pg-token-handover-client-side",children:["Step 2: Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover (Client-side)"]}),"\n",(0,a.jsxs)(n.p,{children:["Partner will now initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover. To initialize OpenFabric SDK, the partner will need to pass"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Access token generated in Step 1"}),"\n",(0,a.jsx)(n.li,{children:"Order details"}),"\n",(0,a.jsx)(n.li,{children:"Payment Gateway details (name of the PG, Sharable Public Key)."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"21-add-dependency",children:"2.1 Add dependency"}),"\n",(0,a.jsx)(n.p,{children:"Partner to include OpenFabric Partner SDK js as a dependency to their payment application."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",metastring:'title="Add Dependency"',children:'<script type="module" src="https://unpkg.com/@openfabric/merchant-sdk@1.0.0/dist/index.umd.min.js">\r\n<\/script>\n'})}),"\n",(0,a.jsx)(n.h4,{id:"step-22-add-tenants-payment-method-button",children:"Step 2.2 Add Tenant\u2019s Payment Method Button"}),"\n",(0,a.jsx)(n.p,{children:"Place tenant button and configure onClick handler for it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",metastring:'lineNumbers title="Add Tenant\u2019s Payment Method Button"',children:'<div id="tenant-button"> /*make this div the action button to initiate the transaction*/ </div> \n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'lineNumbers title="onClick handler"',children:'let tenantButton = document.getElementById("tenant-button");\r\n \r\nopenFabric.initialize().then(() => {\r\n    tenantButton.disabled = false;\r\n});\r\n \r\ntenantButton.onclick = function () {\r\n    if (tenantButton.disabled) {\r\n        return;\r\n    }\r\n    tenantButton.onclick = null; // to avoid double-click\r\n    openFabric.startFlow();\r\n};\n'})}),"\n",(0,a.jsxs)(n.h4,{id:"23-initialize-openfabric-sdk-for-pg-token-handover",children:["2.3 Initialize OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token"})," Handover"]}),"\n",(0,a.jsx)(n.p,{children:"Partner to initialize now initialize the OpenFabric SDK now."}),"\n",(0,a.jsxs)(n.p,{children:["Initializing OpenFabric SDK for ",(0,a.jsx)(n.code,{children:"PG Token Handover"})," will require"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"an access token (generated in step 1),"}),"\n",(0,a.jsx)(n.li,{children:"order details - customer billing/shipping info, etc. ("}),"\n",(0,a.jsx)(n.li,{children:"Callback URLs - success and failure URLs, etc.,"}),"\n",(0,a.jsx)(n.li,{children:"information about their Payment Gateway"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Sample of initializing SDK is below."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'lineNumbers title="Initialize SDK"',children:'// Import Config and FillConfig from our SDK\r\nimport { OpenFabric } from "@openfabric/merchant-sdk"\r\n\r\nconst openFabric = OpenFabric(\r\n    access_token,\r\n    "https://acme-merchant.com/payment-success",// Success redirect url \r\n    "https://acme-merchant.com/payment-failed" // Failure redirect url\r\n)\r\n    .setEnvironment(Environment.production) // use Environment.sandbox to run test transactions. \r\n \r\nconst customer_info = {\r\n    mobile_number: "+632 8855 8800",\r\n    first_name: "John",\r\n    email: "john.doe@gmail.com",\r\n};\r\nconst item = {\r\n    item_id: "P100-1222",\r\n    name: "iPhone",\r\n    variation_name: "Black, 128GB",\r\n    description: "string",\r\n    quantity: 1,\r\n    amount: 1,\r\n    price: 2100.50,\r\n    original_price: 2300,\r\n    categories: ["phone"],\r\n};\r\n \r\nconst address_line_1 = "30th Street corner 11th Avenue Bonifacio Global City, Lane P, Taguig, 1634 Metro Manila";\r\nconst post_code = "1634";\r\n \r\nconst shipping_address = {\r\n    country_code: "ph",\r\n    address_line_1,\r\n    post_code,\r\n};\r\n \r\nconst billing_address = {\r\n    country_code: "ph",\r\n    address_line_1,\r\n    post_code,\r\n};\r\n \r\nconst partner_reference_id = "142134235" // Merchant\u2019s transaction reference ID/Order ID.\r\n \r\nopenFabric.createOrder({\r\n        customer_info,\r\n        amount: 2100.50,\r\n        currency: "PHP",\r\n        partner_reference_id,\r\n        transaction_details: {\r\n            shipping_address,\r\n            billing_address,\r\n            items: [item], // When there are multiple items, the total of all item.price should add up to the amount above. \r\n        },\r\n        pg_name: `${PAYMENT_GATEWAY_NAME}` // use one of the supported \u2018PG Name\u2019 from section 7 in this guide \r\n});\n'})}),"\n",(0,a.jsx)(n.p,{children:"OpenFabric SDK will redirect to the Payment Method's payment approval flow when a customer clicks on the payment button."}),"\n",(0,a.jsxs)(n.h3,{id:"step-3-fetch-and-process-pg-token-with-pg",children:["Step 3: Fetch and Process ",(0,a.jsx)(n.code,{children:"PG Token"})," with PG"]}),"\n",(0,a.jsxs)(n.p,{children:["When the Payment Method approves a transaction, OpenFabric connects to the Payment Gateway used by the Partner, submits the virtual card it has for a transaction to the Payment Gateway, and generates a token (aka ",(0,a.jsx)(n.code,{children:"PG Token"}),") for the virtual card."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"PG Token"})," is passed back to the Partner as part of the redirect query string 'txn_pg_token.'\r\nThe Partner can extract the token from the URL query string using the following code:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'const queryParams = new URLSearchParams(window.location.search);\r\nconst txn_pg_token = queryParams.get("txn_pg_token");\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The Partner should then simply use the ",(0,a.jsx)(n.code,{children:"PG Token"})," to charge the card with their PG."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," If the Tenant declines a transaction, OpenFabric will redirect to the cancel URL specified as part of SDK initialization. Partner is advised to present other viable ways to pay for their customers."]}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"To issue refunds to the customer"}),", Partner simply has initiate a refund against the card with their Payment Gateway (or card processing backend)."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"9-test-and-go-live",children:"9. Test and Go Live"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Partner's Client_ID and Client_Secret (keys) are available in Tenant Servicing Portal (Sandbox and production will have different keys)."}),"\n",(0,a.jsx)(n.li,{children:"Use keys from Sandbox's Tenant Servicing Portal to test transactions against our sandbox and keys from Production's Tenant Servicing Portal to run transactions against our production environment."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"10-references",children:"10. References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/open-fabric/openfabric-integration-samples",children:"Integration Samples"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);