"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[9437],{11470(e,n,r){r.d(n,{A:()=>z});var a=r(96540),t=r(34164),i=r(17559),o=r(23104),s=r(56347),l=r(205),c=r(57485),u=r(31682),d=r(70679);function h(e){var n,r;return null!=(n=null==(r=a.Children.toArray(e).filter(function(e){return"\n"!==e}).map(function(e){if(!e||(0,a.isValidElement)(e)&&((n=e.props)&&"object"==typeof n&&"value"in n))return e;var n;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:r.filter(Boolean))?n:[]}function p(e){var n=e.values,r=e.children;return(0,a.useMemo)(function(){var e=null!=n?n:function(e){return h(e).map(function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes,default:n.default}})}(r);return function(e){var n=(0,u.XI)(e,function(e,n){return e.value===n.value});if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(function(e){return e.value}).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,r])}function m(e){var n=e.value;return e.tabValues.some(function(e){return e.value===n})}function f(e){var n=e.queryString,r=void 0!==n&&n,t=e.groupId,i=(0,s.W6)(),o=function(e){var n=e.queryString,r=void 0!==n&&n,a=e.groupId;if("string"==typeof r)return r;if(!1===r)return null;if(!0===r&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:r,groupId:t});return[(0,c.aZ)(o),(0,a.useCallback)(function(e){if(o){var n=new URLSearchParams(i.location.search);n.set(o,e),i.replace(Object.assign({},i.location,{search:n.toString()}))}},[o,i])]}function g(e){var n,r,t,i,o=e.defaultValue,s=e.queryString,c=void 0!==s&&s,u=e.groupId,h=p(e),g=(0,a.useState)(function(){return function(e){var n,r=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!m({value:r,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+r+'" but none of its children has the corresponding value. Available values are: '+a.map(function(e){return e.value}).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return r}var t=null!=(n=a.find(function(e){return e.default}))?n:a[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:o,tabValues:h})}),b=g[0],v=g[1],x=f({queryString:c,groupId:u}),_=x[0],j=x[1],y=(n=function(e){return e?"docusaurus.tab."+e:null}({groupId:u}.groupId),r=(0,d.Dv)(n),t=r[0],i=r[1],[t,(0,a.useCallback)(function(e){n&&i.set(e)},[n,i])]),w=y[0],z=y[1],A=function(){var e=null!=_?_:w;return m({value:e,tabValues:h})?e:null}();return(0,l.A)(function(){A&&v(A)},[A]),{selectedValue:b,selectValue:(0,a.useCallback)(function(e){if(!m({value:e,tabValues:h}))throw new Error("Can't select invalid tab value="+e);v(e),j(e),z(e)},[j,z,h]),tabValues:h}}var b=r(92303);const v="tabList__CuJ",x="tabItem_LNqP";var _=r(74848);function j(e){var n=e.className,r=e.block,a=e.selectedValue,i=e.selectValue,s=e.tabValues,l=[],c=(0,o.a_)().blockElementScrollPositionUntilNextRender,u=function(e){var n=e.currentTarget,r=l.indexOf(n),t=s[r].value;t!==a&&(c(n),i(t))},d=function(e){var n,r=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":var a,t=l.indexOf(e.currentTarget)+1;r=null!=(a=l[t])?a:l[0];break;case"ArrowLeft":var i,o=l.indexOf(e.currentTarget)-1;r=null!=(i=l[o])?i:l[l.length-1]}null==(n=r)||n.focus()};return(0,_.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":r},n),children:s.map(function(e){var n=e.value,r=e.label,i=e.attributes;return(0,_.jsx)("li",Object.assign({role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:function(e){l.push(e)},onKeyDown:d,onClick:u},i,{className:(0,t.A)("tabs__item",x,null==i?void 0:i.className,{"tabs__item--active":a===n}),children:null!=r?r:n}),n)})})}function y(e){var n=e.lazy,r=e.children,i=e.selectedValue,o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){var s=o.find(function(e){return e.props.value===i});return s?(0,a.cloneElement)(s,{className:(0,t.A)("margin-top--md",s.props.className)}):null}return(0,_.jsx)("div",{className:"margin-top--md",children:o.map(function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==i})})})}function w(e){var n=g(e);return(0,_.jsxs)("div",{className:(0,t.A)(i.G.tabs.container,"tabs-container",v),children:[(0,_.jsx)(j,Object.assign({},n,e)),(0,_.jsx)(y,Object.assign({},n,e))]})}function z(e){var n=(0,b.A)();return(0,_.jsx)(w,Object.assign({},e,{children:h(e.children)}),String(n))}},19365(e,n,r){r.d(n,{A:()=>o});r(96540);var a=r(34164);const t="tabItem_Ymn6";var i=r(74848);function o(e){var n=e.children,r=e.hidden,o=e.className;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(t,o),hidden:r,children:n})}},28453(e,n,r){r.d(n,{R:()=>o,x:()=>s});var a=r(96540);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}},76867(e,n,r){r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"ProcessingPayments/AuthorizationMessages","title":"Authorization messages","description":"Open Fabric forwards real-time authorization messages to your backend for an approval/decline decision. These requests must be handled in sub-second time to avoid network timeouts and customer-facing declines.","source":"@site/docs/ProcessingPayments/AuthorizationMessages.md","sourceDirName":"ProcessingPayments","slug":"/ProcessingPayments/AuthorizationMessages","permalink":"/github.io/docs/ProcessingPayments/AuthorizationMessages","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Payment Processing","permalink":"/github.io/docs/tags/payment-processing"},{"inline":true,"label":"Authorization","permalink":"/github.io/docs/tags/authorization"}],"version":"current","frontMatter":{"title":"Authorization messages","tags":["Payment Processing","Authorization"]},"sidebar":"someSidebar","previous":{"title":"Real-Time Authorization and Clearing Reports","permalink":"/github.io/docs/ProcessingPayments/AuthorizationAndClearing"},"next":{"title":"Reversal notifications","permalink":"/github.io/docs/ProcessingPayments/ReversalNotifications"}}');var t=r(74848),i=r(28453),o=r(11470),s=r(19365);const l={title:"Authorization messages",tags:["Payment Processing","Authorization"]},c="Authorization messages",u={},d=[{value:"Types of authorization",id:"types-of-authorization",level:2},{value:"Final authorization",id:"final-authorization",level:3},{value:"Pre-authorization",id:"pre-authorization",level:3},{value:"Recommended handling of authorization messages",id:"recommended-handling-of-authorization-messages",level:2},{value:"Scenarios where authorization amount can change",id:"scenarios-where-authorization-amount-can-change",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"authorization-messages",children:"Authorization messages"})}),"\n",(0,t.jsxs)(n.p,{children:["Open Fabric forwards real-time ",(0,t.jsx)(n.strong,{children:"authorization messages"})," to your backend for an approval/decline decision. These requests must be handled in ",(0,t.jsx)(n.strong,{children:"sub-second"})," time to avoid network timeouts and customer-facing declines."]}),"\n",(0,t.jsxs)(n.p,{children:["You are expected to expose two REST endpoints that we call for each type of authorization message. After performing your evaluation (for example: customer balance, risk checks, and business rules), respond with a ",(0,t.jsx)(n.code,{children:"200 OK"})," and indicate whether you approve or decline the authorization."]}),"\n",(0,t.jsx)(n.p,{children:"If we receive an error (i.e., any non-200 response such as 4xx/5xx) or a timeout, we will decline the payment on your behalf."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If you are using our ",(0,t.jsx)(n.a,{href:"./AuthorizationAndClearing",children:"Real-time Authorization and Clearing Reports"})," integration, you will need to update your internal ledgers based on the authorization message (see below ",(0,t.jsx)(n.strong,{children:"your typical ledger action"})," for each type of authorization message)."]}),"\n",(0,t.jsxs)(n.li,{children:["If you are using our ",(0,t.jsx)(n.a,{href:"./AuthorizationAndLedgerAPIs",children:"Approval and Ledger APIs"})," integration, you will receive separate API calls to update your internal ledgers."]}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"types-of-authorization",children:"Types of authorization"}),"\n",(0,t.jsx)(n.h3,{id:"final-authorization",children:"Final authorization"}),"\n",(0,t.jsx)(n.p,{children:"This is sent when the merchant knows the exact amount that should be charged for a payment."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Your typical ledger action"}),": deduct available balance."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clearing note"}),": final authorizations are typically ",(0,t.jsx)(n.strong,{children:"not repeated"})," in clearing files unless the merchant later submits a clearing amount that differs from the authorized amount."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Once a final authorization has been approved, it can be active for ",(0,t.jsx)(n.strong,{children:"7 days"}),". During this period, merchants can request settlement. If the merchant does not request settlement, the authorization will expire after 7 days and we will inform you of this expiry in the clearing file and/or the Ledger APIs."]}),"\n",(0,t.jsxs)(n.p,{children:["Please see the ",(0,t.jsx)(n.a,{href:"/apis#tag/Authorization/operation/authorizationMessage",children:"Authorization message in our API Reference"})," for implementation details."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Request Example"',children:'{\r\n  "transaction_id": "6182bde8-ee3e-4bd5-935e-e56507e0f808",\r\n  "network_transaction_ref": "awqcB1rPDuJIm4yKOQbqJUj5MvpdcH6D",\r\n  "customer_id": "8e64c3c2-f409-4e0b-afb7-05cce88d26d7",\r\n  "tenant_customer_ref": "01HG04B4NDBB7XT9JY6H1Y2B3A",\r\n  "account_id": "5ce21f7b-7651-43ea-bf61-b1175f5acbbe",\r\n  "tenant_account_ref": "FR12345678901",\r\n  "provision_id": "f4e52b39-3664-48ce-844c-7a92772b1f2e",\r\n  "provision_type": "customer_account_device",\r\n  "device_id": "f4e52b39-3664-48ce-844c-7a92772b1f2e",\r\n  "network_message_ref": "CZLIzgNfeyMCabcsXp3liJPgSVGyQypHI2A",\r\n  "network_merchant_name": "Merchant123456",\r\n  "network_merchant_id": "6000123456",\r\n  "network_merchant_outlet_address": "Central, Singapore",\r\n  "network_merchant_category_code": "1234",\r\n  "network_merchant_country_code": "SG",\r\n  "network_acquirer_id": "000003",\r\n  "token_requestor_id": "50120834693",\r\n  "auth_indicator": {\r\n\t"is_partial_approval": false,\r\n\t"is_converted_pre_auth": false,\r\n\t"is_incremental_approval": false\r\n  },\r\n  "amount": 20.0,\r\n  "currency": "SGD",\r\n  "billing_amount": 20.0,\r\n  "billing_currency_code": "SGD",\r\n  "billing_exchange_rate": 1.0,\r\n  "settlement_amount": 20.0,\r\n  "settlement_currency_code": "SGD",\r\n  "settlement_exchange_rate": 1.0,\r\n  "transaction_source": "terminal",\r\n  "transaction_category": "other",\r\n  "verification_data": {}\r\n}\n'})}),"\n",(0,t.jsxs)(o.A,{children:[(0,t.jsx)(s.A,{value:"approved",label:"Transaction Approved",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Response Example"',children:'{\r\n  "tenant_reference_id": "31XXXX6723173605",\r\n  "approved_amount": 20.0,\r\n  "authorization_code": "8ABJ6S",\r\n  "status": "approved",\r\n  "reason": null\r\n}\n'})})}),(0,t.jsx)(s.A,{value:"declined",label:"Transaction Declined",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Response Example"',children:'{\r\n  "tenant_reference_id": "31XXXX6723173605",\r\n  "approved_amount": 0.0,\r\n  "authorization_code": "6DBJ9Y",\r\n  "status": "declined",\r\n  "reason": "Insufficient balance"\r\n}\n'})})})]}),"\n",(0,t.jsx)(n.h3,{id:"pre-authorization",children:"Pre-authorization"}),"\n",(0,t.jsx)(n.p,{children:"This is sent when the merchant does not yet know the exact amount to be charged (e.g., hotel deposit, transit) or when fulfillment of the goods or services is not happening right away."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Your typical ledger action"}),": place a ",(0,t.jsx)(n.strong,{children:"hold"})," on funds (earmark balance)."]}),"\n",(0,t.jsxs)(n.li,{children:["A pre-authorization can later be:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"finalized (final clearing)"}),"\n",(0,t.jsx)(n.li,{children:"partially cleared multiple times"}),"\n",(0,t.jsx)(n.li,{children:"expired (release remaining hold)"}),"\n",(0,t.jsx)(n.li,{children:"incremented (additional pre-authorization approvals)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Once a pre-authorization has been approved, it can be active for up to ",(0,t.jsx)(n.strong,{children:"30 days"}),". During this period, merchants can request any of the above actions. If the merchant does not act on the authorization, it will expire after 30 days and we will inform you of this expiry in the clearing file and/or the Ledger APIs."]}),"\n",(0,t.jsxs)(n.p,{children:["Please see the ",(0,t.jsx)(n.a,{href:"/apis#tag/Authorization/operation/authorizationMessage",children:"Authorization message in our API Reference"})," for implementation details."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Request Example"',children:'{\r\n  "transaction_id": "6182bde8-ee3e-4bd5-935e-e56507e0f809",\r\n  "network_transaction_ref": "awqcB1rPDuJIm4yKOQbqJUj5MvpdcH6E",\r\n  "customer_id": "8e64c3c2-f409-4e0b-afb7-05cce88d26d7",\r\n  "tenant_customer_ref": "01HG04B4NDBB7XT9JY6H1Y2B3A",\r\n  "account_id": "5ce21f7b-7651-43ea-bf61-b1175f5acbbe",\r\n  "tenant_account_ref": "FR12345678901",\r\n  "provision_id": "f4e52b39-3664-48ce-844c-7a92772b1f2e",\r\n  "provision_type": "customer_account_device",\r\n  "device_id": "f4e52b39-3664-48ce-844c-7a92772b1f2e",\r\n  "network_message_ref": "CZLIzgNfeyMCabcsXp3liJPgSVGyQypHI2B",\r\n  "network_merchant_name": "Merchant123456",\r\n  "network_merchant_id": "6000123456",\r\n  "network_merchant_outlet_address": "Central, Singapore",\r\n  "network_merchant_category_code": "1234",\r\n  "network_merchant_country_code": "SG",\r\n  "network_acquirer_id": "000003",\r\n  "token_requestor_id": "50120834693",\r\n  "auth_indicator": {\r\n\t"is_incremental_approval": false,\r\n  },\r\n  "amount": 200.0,\r\n  "currency": "SGD",\r\n  "billing_amount": 200.0,\r\n  "billing_currency_code": "SGD",\r\n  "billing_exchange_rate": 1.0,\r\n  "settlement_amount": 200.0,\r\n  "settlement_currency_code": "SGD",\r\n  "settlement_exchange_rate": 1.0,\r\n  "transaction_source": "terminal",\r\n  "transaction_category": "other",\r\n  "verification_data": {}\r\n}\n'})}),"\n",(0,t.jsxs)(o.A,{children:[(0,t.jsx)(s.A,{value:"approved",label:"Transaction Approved",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Response Example"',children:'{\r\n  "tenant_reference_id": "31XXXX6723173606",\r\n  "approved_amount": 200.0,\r\n  "authorization_code": "8ABJ6S",\r\n  "status": "approved",\r\n  "reason": null\r\n}\n'})})}),(0,t.jsx)(s.A,{value:"declined",label:"Transaction Declined",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="Response Example"',children:'{\r\n  "tenant_reference_id": "31XXXX6723173606",\r\n  "approved_amount": 0.0,\r\n  "authorization_code": "6DBJ9Y",\r\n  "status": "declined",\r\n  "reason": "Insufficient balance"\r\n}\n'})})})]}),"\n",(0,t.jsx)(n.h2,{id:"recommended-handling-of-authorization-messages",children:"Recommended handling of authorization messages"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Perform your checks"}),": customer balance, risk rules, merchant rules, etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Return a clear decision"}),": approved/declined, plus a reason for declines."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Update ledgers"}),": update your customer's balance where required."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Be idempotent"}),": handle retries safely if Open Fabric resends the same request."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"scenarios-where-authorization-amount-can-change",children:"Scenarios where authorization amount can change"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Partial approval"})}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"auth_indicator.is_partial_approval"})," is ",(0,t.jsx)(n.code,{children:"true"}),", you may choose to approve a partial amount by decreasing ",(0,t.jsx)(n.code,{children:"approved_amount"})," in the response. This can be useful if the customer's balance is not sufficient for the full amount."]}),"\n",(0,t.jsx)(n.p,{children:"Common use cases are fuel pump pre-authorizations, partial payments via gift cards, or high value amounts where merchants allow multiple cards to be charged for a single purchase."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Incremental authorizations"})}),"\n",(0,t.jsx)(n.p,{children:"Merchants may increase the authorization amount by sending an additional pre-authorization request referring to a previously approved pre-authorization."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you approve this request, increase the hold on the customer's balance."}),"\n",(0,t.jsx)(n.li,{children:"If you decline this request, you decline the increase, but the original hold/authorization is still valid."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Common use cases are hospitality (additional charges such as room service), car rentals (tolls, fuel or late fees) or online groceries/deliveries (basket modifications, weight-based adjustments or tipping)."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"An incremental authorization can also be used by merchants to extend the validity of the pre-authorization by another 30 days."})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Mismatched amounts in clearing file"})}),"\n",(0,t.jsx)(n.p,{children:"There are edge cases where the amount in the clearing file is either higher or lower than the amount in the authorization."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In the case where the amount is less than the original amount and the clearing file indicates this is a ",(0,t.jsx)(n.em,{children:"final"})," authorization (",(0,t.jsx)(n.code,{children:"final_auth"}),", ",(0,t.jsx)(n.code,{children:"final_auth_partial"})," or ",(0,t.jsx)(n.code,{children:"pre_auth_final"}),"), you are required to refund the customer the difference."]}),"\n",(0,t.jsxs)(n.li,{children:["In the case where the amount is more than the original amount, or where you receive an ",(0,t.jsx)(n.em,{children:"unlinked authorization"})," in the clearing file, you are required to deduct the additional amount. In such cases, you may raise a chargeback to request a refund (",(0,t.jsx)(n.code,{children:"is_potential_chargeback"})," in the record will be ",(0,t.jsx)(n.code,{children:"true"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"There are specific cases (for example, transit operators) where there may be a pre-existing agreement allowing the merchant or operator to instruct increased amounts to be cleared and settled."})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);