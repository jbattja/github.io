"use strict";(self.webpackChunk_open_fabric_developer_docs=self.webpackChunk_open_fabric_developer_docs||[]).push([[7997],{28453(e,i,n){n.d(i,{R:()=>l,x:()=>a});var r=n(96540);const t={},o=r.createContext(t);function l(e){const i=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(o.Provider,{value:i},e.children)}},75940(e,i,n){n.r(i),n.d(i,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"AccountTokenization/OwnAppTokens/CreateSecureDeviceWallet","title":"Own App Tokens","description":"Creating a Secure Device Wallet","source":"@site/docs/AccountTokenization/OwnAppTokens/CreateSecureDeviceWallet.md","sourceDirName":"AccountTokenization/OwnAppTokens","slug":"/AccountTokenization/OwnAppTokens/CreateSecureDeviceWallet","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/CreateSecureDeviceWallet","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Account Tokenization","permalink":"/github.io/docs/tags/account-tokenization"},{"inline":true,"label":"Own App Tokens","permalink":"/github.io/docs/tags/own-app-tokens"},{"inline":true,"label":"NFC","permalink":"/github.io/docs/tags/nfc"},{"inline":true,"label":"Tap and Pay","permalink":"/github.io/docs/tags/tap-and-pay"}],"version":"current","frontMatter":{"title":"Own App Tokens","tags":["Account Tokenization","Own App Tokens","NFC","Tap and Pay"]},"sidebar":"someSidebar","previous":{"title":"Overview","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/Overview"},"next":{"title":"Tokenize your customer\'s account","permalink":"/github.io/docs/AccountTokenization/OwnAppTokens/TokenizeCustomerAccount"}}');var t=n(74848),o=n(28453);const l={title:"Own App Tokens",tags:["Account Tokenization","Own App Tokens","NFC","Tap and Pay"]},a="Own App Tokens",s={},c=[{value:"Creating a Secure Device Wallet",id:"creating-a-secure-device-wallet",level:2},{value:"Initialize the SDK",id:"initialize-the-sdk",level:3},{value:"Check if the secure device wallet is provisioned",id:"check-if-the-secure-device-wallet-is-provisioned",level:3},{value:"Initialize provisioning",id:"initialize-provisioning",level:3},{value:"Device eligibility check",id:"device-eligibility-check",level:3},{value:"Start provisioning",id:"start-provisioning",level:3}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"own-app-tokens",children:"Own App Tokens"})}),"\n",(0,t.jsx)(i.h2,{id:"creating-a-secure-device-wallet",children:"Creating a Secure Device Wallet"}),"\n",(0,t.jsxs)(i.p,{children:["To enable NFC payments on a device, the customer\u2019s account must be digitized and provisioned into the user's device. For this process, our SDK creates a ",(0,t.jsx)(i.strong,{children:"secure device wallet"}),", which is a wrapper within the device that stores the tokens securely."]}),"\n",(0,t.jsx)(i.p,{children:"Provisioning is a one-time activity that occurs during the initial setup after installation.\r\nFor subsequent logins, the already provisioned secure device wallet will be utilized."}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"All the secure device wallet provisioning methods are asynchronous. The app needs to listen to the respective callbacks to receive the response. For a more complete example, please refer to the MainActivity.kt file from the provided reference application."})}),"\n",(0,t.jsx)(i.h3,{id:"initialize-the-sdk",children:"Initialize the SDK"}),"\n",(0,t.jsxs)(i.p,{children:["To start using the SDK, first you need to call ",(0,t.jsx)(i.code,{children:"OfNfcSdk.init()"}),", ideally in the ",(0,t.jsx)(i.code,{children:"Activity#onCreate()"})," callback prior to using it."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-kotlin",metastring:'title="MainActivity.kt"',children:"override fun onCreate(savedInstanceState: Bundle?) {\r\n  super.onCreate(savedInstanceState)\r\n      // highlight-next-line\r\n  OfNfcSdk.init(this.application)\r\n}\n"})}),"\n",(0,t.jsx)(i.h3,{id:"check-if-the-secure-device-wallet-is-provisioned",children:"Check if the secure device wallet is provisioned"}),"\n",(0,t.jsxs)(i.p,{children:["Before creating a new secure device wallet, you should check if the device already has a secure device wallet created. This will automatically happen when you invoke ",(0,t.jsx)(i.code,{children:"WalletManager#connect()"})," method within the ",(0,t.jsx)(i.code,{children:"onResume()"})," lifecycle."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-kotlin",metastring:'title="MainActivity.kt"',children:"private val walletManager by lazy {\r\n      // highlight-next-line\r\n  OfNfcSdk.getWalletManager(this.applicationContext, this as WalletManagerCallback)\r\n}\r\n\r\noverride fun onResume() {\r\n  super.onResume()\r\n        // highlight-next-line\r\n  walletManager.connect()\r\n}\n"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"connect()"})," call is asynchronous and triggers one of the wallet manager callbacks being called by the SDK, allowing your app to know in which state the secure device wallet is:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletManagerCallback#onConnectionSuccess()"})," is called when the secure device wallet is already provisioned in the device, and the user can access the functionalities of the secure device wallet. This may mean the secure device wallet exists. Use ",(0,t.jsx)(i.code,{children:"wallet.cards()"})," method to verify the presence of any configured cards in the secure device wallet. If any card with ",(0,t.jsx)(i.code,{children:"CardStatus.ACTIVATED"})," is detected, the device is ready for NFC payment. Otherwise, proceed to ",(0,t.jsx)(i.a,{href:"./TokenizeCustomerAccount",children:"Tokenizing a customer account"})," to now digitize a customer\u2019s account and move from there."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletManagerCallback#onProvisioningRequired()"})," is called when secure device wallet access is refused because there is no wallet currently initialized in the app. This will be the case for all new devices where we are setting them up for NFC payment. You can now proceed to the next section ",(0,t.jsx)(i.a,{href:"#initialize-provisioning",children:"Initialize provisioning"})," to start the provisioning process."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletManagerCallback#onConnectionError()"})," is called when secure device wallet access cannot be made, for a specific reason provided as a method argument."]}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-kotlin",metastring:'title="MainActivity.kt"',children:"override fun onProvisioningRequired() {\r\n  displayProvisioning();\r\n}\r\n\r\noverride fun onConnectionError(\r\n  error: OpenFabricError\r\n) {\r\n  displayError(RuntimeException(error.message))\r\n}\r\n\r\noverride fun onConnectionSuccess(wallet: Wallet) {\r\n  redirectToApp()\r\n}\n"})}),"\n",(0,t.jsx)(i.h3,{id:"initialize-provisioning",children:"Initialize provisioning"}),"\n",(0,t.jsxs)(i.p,{children:["Now that we have determined that a secure device wallet is not already provisioned on the device, we can start with the process to create one. To start the process you have to call ",(0,t.jsx)(i.code,{children:"walletProvisioning.initialize()"})," method."]}),"\n",(0,t.jsx)(i.p,{children:"Initialization is an asynchronous operation during which our SDK checks device OS compatibility and the status of the permissions mandatory for its proper execution."}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"initialize()"})," function triggers any one of the following wallet provisioning callbacks:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onInitializationSuccess()"})," is called when initialization has succeeded."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onInitializationError()"})," is called when initialization has failed for a specific reason and provisioning can\u2019t proceed on the device."]}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-kotlin",metastring:'title="Initialize Provisioning"',children:"val callback = object : WalletProvisioningCallback {\r\n  ...\r\n  override fun onInitializationSuccess() {\r\n    walletProvisioning.checkEligibility(true)\r\n  }\r\n\r\n  override fun onInitializationError(\r\n    error: OpenFabricError\r\n  ) {\r\n    displayError(RuntimeException(error.message))\r\n  }\r\n}\r\n\r\nval walletProvisioning by lazy {\r\n  OfNfcSdk.getWalletProvisioning(this.applicationContext, callback)\r\n}\r\n\r\n\r\nwalletProvisioning.initialize()\n"})}),"\n",(0,t.jsx)(i.h3,{id:"device-eligibility-check",children:"Device eligibility check"}),"\n",(0,t.jsxs)(i.p,{children:["Our SDK requires you to perform an eligibility check using ",(0,t.jsx)(i.code,{children:"walletProvisioning.checkEligibility()"})," method before creating a secure device wallet. A device is considered eligible if it meets the security requirements (i.e. the Android OS version is supported, device is not rooted / running secure firmware, the SDK library integrity is intact and the required device features are supported)."]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.code,{children:"checkEligibility()"})," function triggers any one of the following wallet provisioning callbacks:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onDeviceEligible()"})," is called when the device has been considered as eligible."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onDeviceNotEligible()"})," is called when the device has been considered as not eligible, thus secure device wallet provisioning is not possible on it."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onCheckEligibilityError()"})," is called if the eligibility check has failed, for a specific reason provided as method argument."]}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-kotlin",metastring:'title="Device eligibility Check"',children:'override fun onDeviceEligible(\r\n) {\r\n  walletProvisioning.provision(walletSettingsProfileId)\r\n}\r\n\r\noverride fun onDeviceNotEligible(\r\n  reason: Array<String>?\r\n) {\r\n  displayError(RuntimeException(reason?.joinToString(", ")))\r\n}\r\n\r\noverride fun onCheckEligibilityError(\r\n  error: OpenFabricError,\r\n) {\r\n  displayError(RuntimeException(error.message))\r\n}\n'})}),"\n",(0,t.jsx)(i.h3,{id:"start-provisioning",children:"Start provisioning"}),"\n",(0,t.jsxs)(i.p,{children:["Secure device wallet provisioning is triggered by calling the ",(0,t.jsx)(i.code,{children:"WalletProvisioning.provision()"})," method. It triggers one of the following wallet provisioning callbacks:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onProvisioningSuccess()"})," is called when the secure device wallet has been provisioned successfully into this app. This means the secure device wallet is successfully provisioned and can proceed to ",(0,t.jsx)(i.a,{href:"./TokenizeCustomerAccount",children:"Tokenizing a customer account"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"WalletProvisioningCallback#onProvisioningError()"})," is called when provisioning fails for a specific reason provided as a method argument."]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);